---
title: "Results for PEER Manuscript"
author: "Brent Rappaport"
date: "03/13/2018"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo= FALSE, warning= FALSE)
library(ggplot2)
library(psych)
library(knitr)
library(bookdown)
library(Rmisc)
library(tidyverse)
library(car)
library(lsr)
library(lsmeans)
library(R.utils)
library(descr)
library(lme4)
library(RAMpath)
library(MissMech)
library(broom)
library(Hmisc)
library(xtable)
library(semPlot)
library(lavaan) ##need this to run the analyses
library(ggthemes) ##to help make graphs
library(ggrepel) ##to help make graphs
library(papaja)
library(kableExtra)
library(lavaanPlot)
library(pander)
select <- dplyr::select


data_wide <- read.csv("/Users/BrentRappaport/Box Sync/WashU/Research/PEER/ANALYSIS/PEER/Rappaport_data.csv")
data_wide <- data_wide[,-1]

data_wide <- data_wide %>%
  mutate(MDDPRP100_1 = MDDPRP_1*100,
         MDDPRP100_3 = MDDPRP_3*100,
         MDDPRP100_5 = MDDPRP_5*100,
         MDDPRP100_10 = MDDPRP_10*100,
         MDDPRP100_12 = MDDPRP_12*100,
         MDDPRP100_14 = MDDPRP_14*100,
         MDDPRP100_16 = MDDPRP_16*100,
         MDDPRP100_18 = MDDPRP_18*100)

data_wide <- data_wide[,c(1:2,42,44,45,47,141,347:461)]
```

##Explanation of models
5 main models: First, a baseline model where coupling parameters are fixed to 0. Second, an “interpersonal risk” model where coupling coefficients from dMDD ~ Peer (change in MDD symptoms predicted by Peer relations) are non-zero but are fixed across time. Third, an "interpersonal scar" model where coupling coefficients from dPeer ~ MDD (change in Peer relations predicted by MDD) are non-zero but are fixed across time. Fourth, a "transactional" model where coupling cofficients from Peer to dMDD and MDD to dPeer are non-zero but fixed across time. Fifth, a model where all coupling parameters (dPeer ~ MDD and dMDD ~ Peer) are free to vary over time, used to detect developmental changes in the relationship between Peer relations and MDD symptoms.

Problematic assumptions: assumes measurement invariance & equal distance between assessments (which is true for the most part)
Can test measurement invariance for all HBQ measures, but not for the MDD measures.
Equal distance assumption should be fine since there is only 1 period that is unequal from the rest. Could try running the model from T6 on to see if the results show up the same.

#Bivariate multiwave latent change model for Peer and MDD
###Peer/MDD Baseline model
```{r Peer/MDD Baseline model, echo=FALSE, cache=TRUE}
Peer_MDD_B <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses Peer2 perfectly on Peer1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on Peer2
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6
         
dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP1002
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeer residual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~0*Peer1         # This estimates the Peer to MDD coupling parameter
dMDD2~0*Peer2
dMDD3~0*Peer3
dMDD4~0*Peer4
dMDD5~0*Peer5

dPeer1~0*MDD1         # This estimates the MDD to Peer coupling parameter
dPeer2~0*MDD2
dPeer3~0*MDD3
dPeer4~0*MDD4
dPeer5~0*MDD5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPeer                      # This estimates the iMDD sPeer covariance
iMDD~~iPeer                      # This estimates the iMDD iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sMDD                      # This estimates the iPeer sMDD covariance
sPeer~~sMDD                      # This estimates the sPeer sMDD covariance
'

fit_Peer_MDD_B <- lavaan(Peer_MDD_B, data=data_wide, missing="FIML", estimator="MLR")

##summary(fit_Peer_MDD_B, fit.measures=T, standardized=T)

#semPaths(fit_Peer_MDD_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```


###Peer/MDD Interpersonal Risk model
```{r Peer/MDD Interpersonal Risk model, echo=FALSE, cache=TRUE}
Peer_MDD_IR <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses PPeer_3 perfectly on PPeer_1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on PPeer_3
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6

dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP100_3
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeer residual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~C1*Peer1         # This estimates the Peer to MDD coupling parameter
dMDD2~C1*Peer2
dMDD3~C1*Peer3
dMDD4~C1*Peer4
dMDD5~C1*Peer5

dPeer1~0*MDD1         # This estimates the MDD to Peer coupling parameter
dPeer2~0*MDD2
dPeer3~0*MDD3
dPeer4~0*MDD4
dPeer5~0*MDD5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPeer                      # This estimates the iMDD sPeer covariance
iMDD~~iPeer                      # This estimates the iMDD iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sMDD                      # This estimates the iPeer sMDD covariance
sPeer~~sMDD                      # This estimates the sPeer sMDD covariance
'

fit_Peer_MDD_IR <- lavaan(Peer_MDD_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_MDD_IR, fit.measures=T, standardized=T)

#fitmeasures(fit_Peer_MDD_IR, fit.measures=c("all"), baseline.model= fit_Peer_MDD_B)

#semPaths(fit_Peer_MDD_IR, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```


###Peer/MDD Interpersonal Scar model
```{r Peer/MDD Interpersonal Scar model, echo=FALSE, cache=TRUE}
Peer_MDD_IS <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses PPeer_3 perfectly on PPeer_1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on PPeer_3
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6

dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP100_3
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeer residual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~0*Peer1         # This estimates the Peer to MDD coupling parameter
dMDD2~0*Peer2
dMDD3~0*Peer3
dMDD4~0*Peer4
dMDD5~0*Peer5

dPeer1~C2*MDD1         # This estimates the MDD to Peer coupling parameter
dPeer2~C2*MDD2
dPeer3~C2*MDD3
dPeer4~C2*MDD4
dPeer5~C2*MDD5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPeer                      # This estimates the iMDD sPeer covariance
iMDD~~iPeer                      # This estimates the iMDD iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sMDD                      # This estimates the iPeer sMDD covariance
sPeer~~sMDD                      # This estimates the sPeer sMDD covariance
'

fit_Peer_MDD_IS <- lavaan(Peer_MDD_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_MDD_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Peer_MDD_IS, fit.measures=c("all"), baseline.model= fit_Peer_MDD_B)

#semPaths(fit_Peer_MDD_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Peer/MDD Transactional model
```{r Peer/MDD Transactional model, echo=FALSE, cache=TRUE}
Peer_MDD_T <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses PPeer_3 perfectly on PPeer_1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on PPeer_3
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6
         
dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP100_3
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeer residual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~C1*Peer1         # This estimates the Peer to MDD coupling parameter
dMDD2~C1*Peer2
dMDD3~C1*Peer3
dMDD4~C1*Peer4
dMDD5~C1*Peer5

dPeer1~C2*MDD1         # This estimates the MDD to Peer coupling parameter
dPeer2~C2*MDD2
dPeer3~C2*MDD3
dPeer4~C2*MDD4
dPeer5~C2*MDD5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPeer                      # This estimates the iMDD sPeer covariance
iMDD~~iPeer                      # This estimates the iMDD iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sMDD                      # This estimates the iPeer sMDD covariance
sPeer~~sMDD                      # This estimates the sPeer sMDD covariance
'

fit_Peer_MDD_T <- lavaan(Peer_MDD_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_MDD_T, fit.measures=T, standardized=T)

#bootstrapLRT(h0=fit_Peer_MDD_B, h1=fit_Peer_MDD_T, type="ordinary")

#fitmeasures(fit_Peer_MDD_T, fit.measures=c("all"), baseline.model= fit_Peer_MDD_B)

#semPaths(fit_Peer_MDD_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Peer/MDD Developmental change model
```{r Peer/MDD Developmental change model, echo=FALSE, cache=TRUE}
Peer_MDD <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Peer2 ~ 1*Peer1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

MDD2 ~ 1*MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dPeer1 =~ 1*Peer2
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6
         
dMDD1 =~ 1*MDD2
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeer residual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need_c + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~Peer1       # This estimates the Peer self-feedback parameter
dPeer2~Peer2
dPeer3~Peer3
dPeer4~Peer4
dPeer5~Peer5

dMDD1~MDD1       # This estimates the MDD self-feedback parameter
dMDD2~MDD2
dMDD3~MDD3
dMDD4~MDD4
dMDD5~MDD5

#Estimate coupling parameter
dMDD1~Peer1         # This estimates the Peer to MDD coupling parameter
dMDD2~Peer2
dMDD3~Peer3
dMDD4~Peer4
dMDD5~Peer5

dPeer1~MDD1         # This estimates the MDD to Peer coupling parameter
dPeer2~MDD2
dPeer3~MDD3
dPeer4~MDD4
dPeer5~MDD5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPeer                      # This estimates the iMDD sPeer covariance
iMDD~~iPeer                      # This estimates the iMDD iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sMDD                      # This estimates the iPeer sMDD covariance
sPeer~~sMDD                      # This estimates the sPeer sMDD covariance
'

fit_Peer_MDD <- lavaan(Peer_MDD, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_MDD, fit.measures=T, standardized=T)

#anova(fit_Peer_MDD, fit_Peer_MDD_B)

#Figure 1: Theoretical model
#semPaths(fit_Peer_MDD, 'mod', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=4, sizeInt=2, sizeLat=3, intercepts=FALSE, residuals=T)

#Figure 2: Model fit to data
#semPaths(fit_Peer_MDD, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)

#fitmeasures(fit_Peer_MDD, fit.measures=c("all"), baseline.model= fit_Peer_MDD_B)
```


#Bivariate multiwave latent change model for Peer and INTL
###Peer/INTL Baseline model
```{r Peer/INTL Baseline model, echo=FALSE, cache=TRUE}
Peer_INTL_B <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses Peer2 perfectly on Peer1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on Peer2
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL2**
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeerresidual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~0*Peer1         # This estimates the Peer to INTL coupling parameter
dINTL2~0*Peer2
dINTL3~0*Peer3
dINTL4~0*Peer4
dINTL5~0*Peer5

dPeer1~0*INTL1         # This estimates the INTL to Peer coupling parameter
dPeer2~0*INTL2
dPeer3~0*INTL3
dPeer4~0*INTL4
dPeer5~0*INTL5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPeer                      # This estimates the iINTL sPeer covariance
iINTL~~iPeer                      # This estimates the iINTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sINTL                      # This estimates the iPeer sINTL covariance
sPeer~~sINTL                      # This estimates the sPeer sINTL covariance
'

fit_Peer_INTL_B <- lavaan(Peer_INTL_B, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_INTL_B, fit.measures=T, standardized=T)

#semPaths(fit_Peer_INTL_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Peer/INTL Interpersonal Risk model
```{r Peer/INTL Interpersonal Risk model, echo=FALSE, cache=TRUE}
Peer_INTL_IR <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses Peer2 perfectly on Peer1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on Peer2
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL2
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeerresidual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~C1*Peer1         # This estimates the Peer to INTL coupling parameter
dINTL2~C1*Peer2
dINTL3~C1*Peer3
dINTL4~C1*Peer4
dINTL5~C1*Peer5

dPeer1~0*INTL1         # This estimates the INTL to Peer coupling parameter
dPeer2~0*INTL2
dPeer3~0*INTL3
dPeer4~0*INTL4
dPeer5~0*INTL5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPeer                      # This estimates the iINTL sPeer covariance
iINTL~~iPeer                      # This estimates the iINTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sINTL                      # This estimates the iPeer sINTL covariance
sPeer~~sINTL                      # This estimates the sPeer sINTL covariance
'

fit_Peer_INTL_IR <- lavaan(Peer_INTL_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_INTL_IR, fit.measures=T, standardized=T)

#fitmeasures(fit_Peer_INTL_IR, fit.measures=c("all"), baseline.model= fit_Peer_INTL_B)

#semPaths(fit_Peer_INTL_IR, 'std', 'est', curvePivot=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Peer/INTL Interpersonal Scar model
```{r Peer/INTL Interpersonal Scar model, echo=FALSE, cache=TRUE}
Peer_INTL_IS <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses PPeer_3 perfectly on PPeer_1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on PPeer_3
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6

dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL_3
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeerresidual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~0*Peer1         # This estimates the Peer to INTL coupling parameter
dINTL2~0*Peer2
dINTL3~0*Peer3
dINTL4~0*Peer4
dINTL5~0*Peer5

dPeer1~C2*INTL1         # This estimates the INTL to Peer coupling parameter
dPeer2~C2*INTL2
dPeer3~C2*INTL3
dPeer4~C2*INTL4
dPeer5~C2*INTL5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPeer                      # This estimates the iINTL sPeer covariance
iINTL~~iPeer                      # This estimates the iINTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sINTL                      # This estimates the iPeer sINTL covariance
sPeer~~sINTL                      # This estimates the sPeer sINTL covariance
'

fit_Peer_INTL_IS <- lavaan(Peer_INTL_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_INTL_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Peer_INTL_IS, fit.measures=c("all"), baseline.model= fit_Peer_INTL_B)

#semPaths(fit_Peer_INTL_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Peer/INTL Transactional model
```{r Peer/INTL Transactional model, echo=FALSE, cache=TRUE}
Peer_INTL_T <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses PPeer_3 perfectly on PPeer_1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on PPeer_3
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL_3
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeerresidual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~C1*Peer1         # This estimates the Peer to INTL coupling parameter
dINTL2~C1*Peer2
dINTL3~C1*Peer3
dINTL4~C1*Peer4
dINTL5~C1*Peer5

dPeer1~C2*INTL1         # This estimates the INTL to Peer coupling parameter
dPeer2~C2*INTL2
dPeer3~C2*INTL3
dPeer4~C2*INTL4
dPeer5~C2*INTL5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPeer                      # This estimates the iINTL sPeer covariance
iINTL~~iPeer                      # This estimates the iINTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sINTL                      # This estimates the iPeer sINTL covariance
sPeer~~sINTL                      # This estimates the sPeer sINTL covariance
'

fit_Peer_INTL_T <- lavaan(Peer_INTL_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_INTL_T, fit.measures=T, standardized=T)

#fitmeasures(fit_Peer_INTL_T, fit.measures=c("all"), baseline.model= fit_Peer_INTL_B)

#semPaths(fit_Peer_INTL_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Peer/INTL Developmental change model
```{r Peer/INTL Developmental change model, echo=FALSE, cache=TRUE}
Peer_INTL <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Peer2 ~ 1*Peer1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

INTL2 ~ 1*INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dPeer1 =~ 1*Peer2
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6
         
dINTL1 =~ 1*INTL2
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeerresidual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~Peer1       # This estimates the Peer self-feedback parameter
dPeer2~Peer2
dPeer3~Peer3
dPeer4~Peer4
dPeer5~Peer5

dINTL1~INTL1       # This estimates the INTL self-feedback parameter
dINTL2~INTL2
dINTL3~INTL3
dINTL4~INTL4
dINTL5~INTL5

#Estimate coupling parameter
dINTL1~Peer1         # This estimates the Peer to INTL coupling parameter
dINTL2~Peer2
dINTL3~Peer3
dINTL4~Peer4
dINTL5~Peer5

dPeer1~INTL1         # This estimates the INTL to Peer coupling parameter
dPeer2~INTL2
dPeer3~INTL3
dPeer4~INTL4
dPeer5~INTL5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPeer                      # This estimates the iINTL sPeer covariance
iINTL~~iPeer                      # This estimates the iINTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sINTL                      # This estimates the iPeer sINTL covariance
sPeer~~sINTL                      # This estimates the sPeer sINTL covariance
'

fit_Peer_INTL <- lavaan(Peer_INTL, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_INTL, fit.measures=T, standardized=T)

#fitmeasures(fit_Peer_INTL, fit.measures=c("all"), baseline.model= fit_Peer_INTL_B)

#semPaths(fit_Peer_INTL, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```



#Bivariate multiwave latent change model for Peer and EXTL
###Peer/EXTL Baseline model
```{r Peer/EXTL Baseline model, echo=FALSE, cache=TRUE}
Peer_EXTL_B <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses Peer2 perfectly on Peer1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on Peer2
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL2**
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeerresidual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~0*Peer1         # This estimates the Peer to EXTL coupling parameter
dEXTL2~0*Peer2
dEXTL3~0*Peer3
dEXTL4~0*Peer4
dEXTL5~0*Peer5

dPeer1~0*EXTL1         # This estimates the EXTL to Peer coupling parameter
dPeer2~0*EXTL2
dPeer3~0*EXTL3
dPeer4~0*EXTL4
dPeer5~0*EXTL5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPeer                      # This estimates the iEXTL sPeer covariance
iEXTL~~iPeer                      # This estimates the iEXTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sEXTL                      # This estimates the iPeer sEXTL covariance
sPeer~~sEXTL                      # This estimates the sPeer sEXTL covariance
'

fit_Peer_EXTL_B <- lavaan(Peer_EXTL_B, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_EXTL_B, fit.measures=T, standardized=T)

#semPaths(fit_Peer_EXTL_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Peer/EXTL Interpersonal Risk model
```{r Peer/EXTL Interpersonal Risk model, echo=FALSE, cache=TRUE}
Peer_EXTL_IR <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses Peer2 perfectly on Peer1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on Peer2
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL2
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeer residual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeer residual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~C1*Peer1         # This estimates the Peer to EXTL coupling parameter
dEXTL2~C1*Peer2
dEXTL3~C1*Peer3
dEXTL4~C1*Peer4
dEXTL5~C1*Peer5

dPeer1~0*EXTL1         # This estimates the EXTL to Peer coupling parameter
dPeer2~0*EXTL2
dPeer3~0*EXTL3
dPeer4~0*EXTL4
dPeer5~0*EXTL5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPeer                      # This estimates the iEXTL sPeer covariance
iEXTL~~iPeer                      # This estimates the iEXTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sEXTL                      # This estimates the iPeer sEXTL covariance
sPeer~~sEXTL                      # This estimates the sPeer sEXTL covariance
'

fit_Peer_EXTL_IR <- lavaan(Peer_EXTL_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_EXTL_IR, fit.measures=T, standardized=T)

#anova(fit_Peer_EXTL_IR, fit_Peer_EXTL_B)

#fitmeasures(fit_Peer_EXTL_IR, fit.measures=c("all"), baseline.model= fit_Peer_EXTL_B)

#semPaths(fit_Peer_EXTL_IR, 'std', 'est', curvePivot=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Peer/EXTL Interpersonal Scar model
```{r Peer/EXTL Interpersonal Scar model, echo=FALSE, cache=TRUE}
Peer_EXTL_IS <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses PPeer_3 perfectly on PPeer_1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on PPeer_3
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6

dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL_3
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeerresidual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~0*Peer1         # This estimates the Peer to EXTL coupling parameter
dEXTL2~0*Peer2
dEXTL3~0*Peer3
dEXTL4~0*Peer4
dEXTL5~0*Peer5

dPeer1~C2*EXTL1         # This estimates the EXTL to Peer coupling parameter
dPeer2~C2*EXTL2
dPeer3~C2*EXTL3
dPeer4~C2*EXTL4
dPeer5~C2*EXTL5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPeer                      # This estimates the iEXTL sPeer covariance
iEXTL~~iPeer                      # This estimates the iEXTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sEXTL                      # This estimates the iPeer sEXTL covariance
sPeer~~sEXTL                      # This estimates the sPeer sEXTL covariance
'

fit_Peer_EXTL_IS <- lavaan(Peer_EXTL_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_EXTL_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Peer_EXTL_IS, fit.measures=c("all"), baseline.model= fit_Peer_EXTL_B)

#semPaths(fit_Peer_EXTL_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Peer/EXTL Transactional model
```{r Peer/EXTL Transactional model, echo=FALSE, cache=TRUE}
Peer_EXTL_T <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Peer2 ~ 1*Peer1     # This parameter regresses PPeer_3 perfectly on PPeer_1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dPeer1 =~ 1*Peer2        # This defines the change score as measured perfectly by scores on PPeer_3
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL_3
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeerresidual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~F1*Peer1       # This estimates the Peer self-feedback parameter
dPeer2~F1*Peer2
dPeer3~F1*Peer3
dPeer4~F1*Peer4
dPeer5~F1*Peer5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~C1*Peer1         # This estimates the Peer to EXTL coupling parameter
dEXTL2~C1*Peer2
dEXTL3~C1*Peer3
dEXTL4~C1*Peer4
dEXTL5~C1*Peer5

dPeer1~C2*EXTL1         # This estimates the EXTL to Peer coupling parameter
dPeer2~C2*EXTL2
dPeer3~C2*EXTL3
dPeer4~C2*EXTL4
dPeer5~C2*EXTL5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPeer                      # This estimates the iEXTL sPeer covariance
iEXTL~~iPeer                      # This estimates the iEXTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sEXTL                      # This estimates the iPeer sEXTL covariance
sPeer~~sEXTL                      # This estimates the sPeer sEXTL covariance
'

fit_Peer_EXTL_T <- lavaan(Peer_EXTL_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_EXTL_T, fit.measures=T, standardized=T)

#fitmeasures(fit_Peer_EXTL_T, fit.measures=c("all"), baseline.model= fit_Peer_EXTL_B)

#semPaths(fit_Peer_EXTL_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Peer/EXTL Developmental change model
```{r Peer/EXTL Developmental change model, echo=FALSE, cache=TRUE}
Peer_EXTL <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Peer2 ~ 1*Peer1
Peer3 ~ 1*Peer2
Peer4 ~ 1*Peer3
Peer5 ~ 1*Peer4
Peer6 ~ 1*Peer5

EXTL2 ~ 1*EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dPeer1 =~ 1*Peer2
dPeer2 =~ 1*Peer3
dPeer3 =~ 1*Peer4
dPeer4 =~ 1*Peer5
dPeer5 =~ 1*Peer6
         
dEXTL1 =~ 1*EXTL2
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeerresidual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Peer1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Peer6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPeer1~Peer1       # This estimates the Peer self-feedback parameter
dPeer2~Peer2
dPeer3~Peer3
dPeer4~Peer4
dPeer5~Peer5

dEXTL1~EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~EXTL2
dEXTL3~EXTL3
dEXTL4~EXTL4
dEXTL5~EXTL5

#Estimate coupling parameter
dEXTL1~Peer1         # This estimates the Peer to EXTL coupling parameter
dEXTL2~Peer2
dEXTL3~Peer3
dEXTL4~Peer4
dEXTL5~Peer5

dPeer1~EXTL1         # This estimates the EXTL to Peer coupling parameter
dPeer2~EXTL2
dPeer3~EXTL3
dPeer4~EXTL4
dPeer5~EXTL5

iPeer=~1*Peer1                   # This defines the Peer intercept measurement model
sPeer=~1*dPeer1+ 1*dPeer2+ 1*dPeer3+ 1*dPeer4+ 1*dPeer5 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPeer                      # This estimates the iEXTL sPeer covariance
iEXTL~~iPeer                      # This estimates the iEXTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sEXTL                      # This estimates the iPeer sEXTL covariance
sPeer~~sEXTL                      # This estimates the sPeer sEXTL covariance
'

fit_Peer_EXTL <- lavaan(Peer_EXTL, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Peer_EXTL, fit.measures=T, standardized=T)

#anova(fit_Peer_EXTL, fit_Peer_EXTL_B)

#fitmeasures(fit_Peer_EXTL, fit.measures=c("all"), baseline.model= fit_Peer_EXTL_B)

#semPaths(fit_Peer_EXTL, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```





#Bivariate multiwave latent change model for Agg and MDD
###Agg/MDD Baseline model
```{r Agg/MDD Baseline model, echo=FALSE, cache=TRUE}
Agg_MDD_B <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses Agg2 perfectly on Agg1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on Agg2
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP1002
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAgg residual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~0*Agg1         # This estimates the Agg to MDD coupling parameter
dMDD2~0*Agg2
dMDD3~0*Agg3
dMDD4~0*Agg4
dMDD5~0*Agg5

dAgg1~0*MDD1         # This estimates the MDD to Agg coupling parameter
dAgg2~0*MDD2
dAgg3~0*MDD3
dAgg4~0*MDD4
dAgg5~0*MDD5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sAgg                      # This estimates the iMDD sAgg covariance
iMDD~~iAgg                      # This estimates the iMDD iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sMDD                      # This estimates the iAgg sMDD covariance
sAgg~~sMDD                      # This estimates the sAgg sMDD covariance
'

fit_Agg_MDD_B <- lavaan(Agg_MDD_B, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_MDD_B, fit.measures=T, standardized=T)

#semPaths(fit_Agg_MDD_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/MDD Interpersonal Risk model
```{r Agg/MDD Interpersonal Risk model, echo=FALSE, cache=TRUE}
Agg_MDD_IR <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses Agg2 perfectly on Agg1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on Agg2
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDD2
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAgg residual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~C1*Agg1         # This estimates the Agg to MDD coupling parameter
dMDD2~C1*Agg2
dMDD3~C1*Agg3
dMDD4~C1*Agg4
dMDD5~C1*Agg5

dAgg1~0*MDD1         # This estimates the MDD to Agg coupling parameter
dAgg2~0*MDD2
dAgg3~0*MDD3
dAgg4~0*MDD4
dAgg5~0*MDD5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sAgg                      # This estimates the iMDD sAgg covariance
iMDD~~iAgg                      # This estimates the iMDD iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sMDD                      # This estimates the iAgg sMDD covariance
sAgg~~sMDD                      # This estimates the sAgg sMDD covariance
'

fit_Agg_MDD_IR <- lavaan(Agg_MDD_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_MDD_IR, fit.measures=T, standardized=T)

#fitmeasures(fit_Agg_MDD_IR, fit.measures=c("all"), baseline.model= fit_Agg_MDD_B)

#semPaths(fit_Agg_MDD_IR, 'std', 'est', curvePivot=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/MDD Interpersonal Scar model
```{r Agg/MDD Interpersonal Scar model, echo=FALSE, cache=TRUE}
Agg_MDD_IS <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses PAgg_3 perfectly on PAgg_1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on PAgg_3
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6

dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP100_3
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAgg residual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~0*Agg1         # This estimates the Agg to MDD coupling parameter
dMDD2~0*Agg2
dMDD3~0*Agg3
dMDD4~0*Agg4
dMDD5~0*Agg5

dAgg1~C2*MDD1         # This estimates the MDD to Agg coupling parameter
dAgg2~C2*MDD2
dAgg3~C2*MDD3
dAgg4~C2*MDD4
dAgg5~C2*MDD5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sAgg                      # This estimates the iMDD sAgg covariance
iMDD~~iAgg                      # This estimates the iMDD iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sMDD                      # This estimates the iAgg sMDD covariance
sAgg~~sMDD                      # This estimates the sAgg sMDD covariance
'

fit_Agg_MDD_IS <- lavaan(Agg_MDD_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_MDD_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Agg_MDD_IS, fit.measures=c("all"), baseline.model= fit_Agg_MDD_B)

#semPaths(fit_Agg_MDD_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/MDD Transactional model
```{r Agg/MDD Transactional model, echo=FALSE, cache=TRUE}
Agg_MDD_T <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses PAgg_3 perfectly on PAgg_1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on PAgg_3
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP100_3
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAgg residual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~C1*Agg1         # This estimates the Agg to MDD coupling parameter
dMDD2~C1*Agg2
dMDD3~C1*Agg3
dMDD4~C1*Agg4
dMDD5~C1*Agg5

dAgg1~C2*MDD1         # This estimates the MDD to Agg coupling parameter
dAgg2~C2*MDD2
dAgg3~C2*MDD3
dAgg4~C2*MDD4
dAgg5~C2*MDD5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sAgg                      # This estimates the iMDD sAgg covariance
iMDD~~iAgg                      # This estimates the iMDD iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sMDD                      # This estimates the iAgg sMDD covariance
sAgg~~sMDD                      # This estimates the sAgg sMDD covariance
'

fit_Agg_MDD_T <- lavaan(Agg_MDD_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_MDD_T, fit.measures=T, standardized=T)

#fitmeasures(fit_Agg_MDD_T, fit.measures=c("all"), baseline.model= fit_Agg_MDD_B)

#semPaths(fit_Agg_MDD_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
##         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/MDD Developmental change model
```{r Agg/MDD Developmental change model, echo=FALSE, cache=TRUE}
Agg_MDD <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Agg2 ~ 1*Agg1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

MDD2 ~ 1*MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dAgg1 =~ 1*Agg2
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dMDD1 =~ 1*MDD2
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAgg residual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~Agg1       # This estimates the Agg self-feedback parameter
dAgg2~Agg2
dAgg3~Agg3
dAgg4~Agg4
dAgg5~Agg5

dMDD1~MDD1       # This estimates the MDD self-feedback parameter
dMDD2~MDD2
dMDD3~MDD3
dMDD4~MDD4
dMDD5~MDD5

#Estimate coupling parameter
dMDD1~Agg1         # This estimates the Agg to MDD coupling parameter
dMDD2~Agg2
dMDD3~Agg3
dMDD4~Agg4
dMDD5~Agg5

dAgg1~MDD1         # This estimates the MDD to Agg coupling parameter
dAgg2~MDD2
dAgg3~MDD3
dAgg4~MDD4
dAgg5~MDD5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sAgg                      # This estimates the iMDD sAgg covariance
iMDD~~iAgg                      # This estimates the iMDD iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sMDD                      # This estimates the iAgg sMDD covariance
sAgg~~sMDD                      # This estimates the sAgg sMDD covariance
'

fit_Agg_MDD <- lavaan(Agg_MDD, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_MDD, fit.measures=T, standardized=T)

#fitmeasures(fit_Agg_MDD, fit.measures=c("all"), baseline.model= fit_Agg_MDD_B)

#semPaths(fit_Agg_MDD, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```


#Bivariate multiwave latent change model for Agg and INTL
###Agg/INTL Baseline model
```{r Agg/INTL Baseline model, echo=FALSE, cache=TRUE}
Agg_INTL_B <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses Agg2 perfectly on Agg1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on Agg2
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL2**
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAggresidual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~0*Agg1         # This estimates the Agg to INTL coupling parameter
dINTL2~0*Agg2
dINTL3~0*Agg3
dINTL4~0*Agg4
dINTL5~0*Agg5

dAgg1~0*INTL1         # This estimates the INTL to Agg coupling parameter
dAgg2~0*INTL2
dAgg3~0*INTL3
dAgg4~0*INTL4
dAgg5~0*INTL5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sAgg                      # This estimates the iINTL sAgg covariance
iINTL~~iAgg                      # This estimates the iINTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sINTL                      # This estimates the iAgg sINTL covariance
sAgg~~sINTL                      # This estimates the sAgg sINTL covariance
'

fit_Agg_INTL_B <- lavaan(Agg_INTL_B, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_INTL_B, fit.measures=T, standardized=T)

#semPaths(fit_Agg_INTL_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/INTL Interpersonal Risk model
```{r Agg/INTL Interpersonal Risk model, echo=FALSE, cache=TRUE}
Agg_INTL_IR <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses Agg2 perfectly on Agg1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on Agg2
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL2
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAggresidual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~C1*Agg1         # This estimates the Agg to INTL coupling parameter
dINTL2~C1*Agg2
dINTL3~C1*Agg3
dINTL4~C1*Agg4
dINTL5~C1*Agg5

dAgg1~0*INTL1         # This estimates the INTL to Agg coupling parameter
dAgg2~0*INTL2
dAgg3~0*INTL3
dAgg4~0*INTL4
dAgg5~0*INTL5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sAgg                      # This estimates the iINTL sAgg covariance
iINTL~~iAgg                      # This estimates the iINTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sINTL                      # This estimates the iAgg sINTL covariance
sAgg~~sINTL                      # This estimates the sAgg sINTL covariance
'

fit_Agg_INTL_IR <- lavaan(Agg_INTL_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_INTL_IR, fit.measures=T, standardized=T)

#fitmeasures(fit_Agg_INTL_IR, fit.measures=c("all"), baseline.model= fit_Agg_INTL_B)

#semPaths(fit_Agg_INTL_IR, 'std', 'est', curvePivot=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/INTL Interpersonal Scar model
```{r Agg/INTL Interpersonal Scar model, echo=FALSE, cache=TRUE}
Agg_INTL_IS <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses PAgg_3 perfectly on PAgg_1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on PAgg_3
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6

dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL_3
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAggresidual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~0*Agg1         # This estimates the Agg to INTL coupling parameter
dINTL2~0*Agg2
dINTL3~0*Agg3
dINTL4~0*Agg4
dINTL5~0*Agg5

dAgg1~C2*INTL1         # This estimates the INTL to Agg coupling parameter
dAgg2~C2*INTL2
dAgg3~C2*INTL3
dAgg4~C2*INTL4
dAgg5~C2*INTL5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sAgg                      # This estimates the iINTL sAgg covariance
iINTL~~iAgg                      # This estimates the iINTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sINTL                      # This estimates the iAgg sINTL covariance
sAgg~~sINTL                      # This estimates the sAgg sINTL covariance
'

fit_Agg_INTL_IS <- lavaan(Agg_INTL_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_INTL_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Agg_INTL_IS, fit.measures=c("all"), baseline.model= fit_Agg_INTL_B)

#semPaths(fit_Agg_INTL_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/INTL Transactional model
```{r Agg/INTL Transactional model, echo=FALSE, cache=TRUE}
Agg_INTL_T <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses PAgg_3 perfectly on PAgg_1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on PAgg_3
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL_3
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAggresidual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~C1*Agg1         # This estimates the Agg to INTL coupling parameter
dINTL2~C1*Agg2
dINTL3~C1*Agg3
dINTL4~C1*Agg4
dINTL5~C1*Agg5

dAgg1~C2*INTL1         # This estimates the INTL to Agg coupling parameter
dAgg2~C2*INTL2
dAgg3~C2*INTL3
dAgg4~C2*INTL4
dAgg5~C2*INTL5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sAgg                      # This estimates the iINTL sAgg covariance
iINTL~~iAgg                      # This estimates the iINTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sINTL                      # This estimates the iAgg sINTL covariance
sAgg~~sINTL                      # This estimates the sAgg sINTL covariance
'

fit_Agg_INTL_T <- lavaan(Agg_INTL_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_INTL_T, fit.measures=T, standardized=T)

#fitmeasures(fit_Agg_INTL_T, fit.measures=c("all"), baseline.model= fit_Agg_INTL_B)

#semPaths(fit_Agg_INTL_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/INTL Developmental change model
```{r Agg/INTL Developmental change model, echo=FALSE, cache=TRUE}
Agg_INTL <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Agg2 ~ 1*Agg1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

INTL2 ~ 1*INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dAgg1 =~ 1*Agg2
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dINTL1 =~ 1*INTL2
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAggresidual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~Agg1       # This estimates the Agg self-feedback parameter
dAgg2~Agg2
dAgg3~Agg3
dAgg4~Agg4
dAgg5~Agg5

dINTL1~INTL1       # This estimates the INTL self-feedback parameter
dINTL2~INTL2
dINTL3~INTL3
dINTL4~INTL4
dINTL5~INTL5

#Estimate coupling parameter
dINTL1~Agg1         # This estimates the Agg to INTL coupling parameter
dINTL2~Agg2
dINTL3~Agg3
dINTL4~Agg4
dINTL5~Agg5

dAgg1~INTL1         # This estimates the INTL to Agg coupling parameter
dAgg2~INTL2
dAgg3~INTL3
dAgg4~INTL4
dAgg5~INTL5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sAgg                      # This estimates the iINTL sAgg covariance
iINTL~~iAgg                      # This estimates the iINTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sINTL                      # This estimates the iAgg sINTL covariance
sAgg~~sINTL                      # This estimates the sAgg sINTL covariance
'

fit_Agg_INTL <- lavaan(Agg_INTL, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_INTL, fit.measures=T, standardized=T)

#fitmeasures(fit_Agg_INTL, fit.measures=c("all"), baseline.model= fit_Agg_INTL_B)

#semPaths(fit_Agg_INTL, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```



#Bivariate multiwave latent change model for Agg and EXTL
###Agg/EXTL Baseline model
```{r Agg/EXTL Baseline model, echo=FALSE, cache=TRUE}
Agg_EXTL_B <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses Agg2 perfectly on Agg1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on Agg2
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL2**
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAggresidual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~0*Agg1         # This estimates the Agg to EXTL coupling parameter
dEXTL2~0*Agg2
dEXTL3~0*Agg3
dEXTL4~0*Agg4
dEXTL5~0*Agg5

dAgg1~0*EXTL1         # This estimates the EXTL to Agg coupling parameter
dAgg2~0*EXTL2
dAgg3~0*EXTL3
dAgg4~0*EXTL4
dAgg5~0*EXTL5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sAgg                      # This estimates the iEXTL sAgg covariance
iEXTL~~iAgg                      # This estimates the iEXTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sEXTL                      # This estimates the iAgg sEXTL covariance
sAgg~~sEXTL                      # This estimates the sAgg sEXTL covariance
'

fit_Agg_EXTL_B <- lavaan(Agg_EXTL_B, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_EXTL_B, fit.measures=T, standardized=T)

#semPaths(fit_Agg_EXTL_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/EXTL Interpersonal Risk model
```{r Agg/EXTL Interpersonal Risk model, echo=FALSE, cache=TRUE}
Agg_EXTL_IR <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses Agg2 perfectly on Agg1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on Agg2
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL2
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAgg residual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAgg residual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~C1*Agg1         # This estimates the Agg to EXTL coupling parameter
dEXTL2~C1*Agg2
dEXTL3~C1*Agg3
dEXTL4~C1*Agg4
dEXTL5~C1*Agg5

dAgg1~0*EXTL1         # This estimates the EXTL to Agg coupling parameter
dAgg2~0*EXTL2
dAgg3~0*EXTL3
dAgg4~0*EXTL4
dAgg5~0*EXTL5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sAgg                      # This estimates the iEXTL sAgg covariance
iEXTL~~iAgg                      # This estimates the iEXTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sEXTL                      # This estimates the iAgg sEXTL covariance
sAgg~~sEXTL                      # This estimates the sAgg sEXTL covariance
'

fit_Agg_EXTL_IR <- lavaan(Agg_EXTL_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_EXTL_IR, fit.measures=T, standardized=T)

#fitmeasures(fit_Agg_EXTL_IR, fit.measures=c("all"), baseline.model= fit_Agg_EXTL_B)

#semPaths(fit_Agg_EXTL_IR, 'std', 'est', curvePivot=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/EXTL Interpersonal Scar model
```{r Agg/EXTL Interpersonal Scar model, echo=FALSE, cache=TRUE}
Agg_EXTL_IS <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses PAgg_3 perfectly on PAgg_1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on PAgg_3
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6

dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL_3
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAggresidual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~0*Agg1         # This estimates the Agg to EXTL coupling parameter
dEXTL2~0*Agg2
dEXTL3~0*Agg3
dEXTL4~0*Agg4
dEXTL5~0*Agg5

dAgg1~C2*EXTL1         # This estimates the EXTL to Agg coupling parameter
dAgg2~C2*EXTL2
dAgg3~C2*EXTL3
dAgg4~C2*EXTL4
dAgg5~C2*EXTL5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sAgg                      # This estimates the iEXTL sAgg covariance
iEXTL~~iAgg                      # This estimates the iEXTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sEXTL                      # This estimates the iAgg sEXTL covariance
sAgg~~sEXTL                      # This estimates the sAgg sEXTL covariance
'

fit_Agg_EXTL_IS <- lavaan(Agg_EXTL_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_EXTL_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Agg_EXTL_IS, fit.measures=c("all"), baseline.model= fit_Agg_EXTL_B)

#semPaths(fit_Agg_EXTL_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/EXTL Transactional model
```{r Agg/EXTL Transactional model, echo=FALSE, cache=TRUE}
Agg_EXTL_T <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Agg2 ~ 1*Agg1     # This parameter regresses PAgg_3 perfectly on PAgg_1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dAgg1 =~ 1*Agg2        # This defines the change score as measured perfectly by scores on PAgg_3
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL_3
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAggresidual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~F1*Agg1       # This estimates the Agg self-feedback parameter
dAgg2~F1*Agg2
dAgg3~F1*Agg3
dAgg4~F1*Agg4
dAgg5~F1*Agg5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~C1*Agg1         # This estimates the Agg to EXTL coupling parameter
dEXTL2~C1*Agg2
dEXTL3~C1*Agg3
dEXTL4~C1*Agg4
dEXTL5~C1*Agg5

dAgg1~C2*EXTL1         # This estimates the EXTL to Agg coupling parameter
dAgg2~C2*EXTL2
dAgg3~C2*EXTL3
dAgg4~C2*EXTL4
dAgg5~C2*EXTL5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sAgg                      # This estimates the iEXTL sAgg covariance
iEXTL~~iAgg                      # This estimates the iEXTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sEXTL                      # This estimates the iAgg sEXTL covariance
sAgg~~sEXTL                      # This estimates the sAgg sEXTL covariance
'

fit_Agg_EXTL_T <- lavaan(Agg_EXTL_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_EXTL_T, fit.measures=T, standardized=T)

#fitmeasures(fit_Agg_EXTL_T, fit.measures=c("all"), baseline.model= fit_Agg_EXTL_B)

#semPaths(fit_Agg_EXTL_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Agg/EXTL Developmental change model
```{r Agg/EXTL Developmental change model, echo=FALSE, cache=TRUE}
Agg_EXTL <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Agg2 ~ 1*Agg1
Agg3 ~ 1*Agg2
Agg4 ~ 1*Agg3
Agg5 ~ 1*Agg4
Agg6 ~ 1*Agg5

EXTL2 ~ 1*EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dAgg1 =~ 1*Agg2
dAgg2 =~ 1*Agg3
dAgg3 =~ 1*Agg4
dAgg4 =~ 1*Agg5
dAgg5 =~ 1*Agg6
         
dEXTL1 =~ 1*EXTL2
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAggresidual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Agg1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Agg6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dAgg1~Agg1       # This estimates the Agg self-feedback parameter
dAgg2~Agg2
dAgg3~Agg3
dAgg4~Agg4
dAgg5~Agg5

dEXTL1~EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~EXTL2
dEXTL3~EXTL3
dEXTL4~EXTL4
dEXTL5~EXTL5

#Estimate coupling parameter
dEXTL1~Agg1         # This estimates the Agg to EXTL coupling parameter
dEXTL2~Agg2
dEXTL3~Agg3
dEXTL4~Agg4
dEXTL5~Agg5

dAgg1~EXTL1         # This estimates the EXTL to Agg coupling parameter
dAgg2~EXTL2
dAgg3~EXTL3
dAgg4~EXTL4
dAgg5~EXTL5

iAgg=~1*Agg1                   # This defines the Agg intercept measurement model
sAgg=~1*dAgg1+ 1*dAgg2+ 1*dAgg3+ 1*dAgg4+ 1*dAgg5 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sAgg                      # This estimates the iEXTL sAgg covariance
iEXTL~~iAgg                      # This estimates the iEXTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sEXTL                      # This estimates the iAgg sEXTL covariance
sAgg~~sEXTL                      # This estimates the sAgg sEXTL covariance
'

fit_Agg_EXTL <- lavaan(Agg_EXTL, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Agg_EXTL, fit.measures=T, standardized=T)

#anova(fit_Agg_EXTL, fit_Agg_EXTL_B)
#anova(fit_Agg_EXTL, fit_Agg_EXTL_T)

#fitmeasures(fit_Agg_EXTL, fit.measures=c("all"), baseline.model= fit_Agg_EXTL_B)

#semPaths(fit_Agg_EXTL, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```


#Bivariate multiwave latent change model for Sw and MDD
###Sw/MDD Baseline model
```{r Sw/MDD Baseline model, echo=FALSE, cache=TRUE}
Sw_MDD_B <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses Sw2 perfectly on Sw1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on Sw2
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP1002
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSw residual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~0*Sw1         # This estimates the Sw to MDD coupling parameter
dMDD2~0*Sw2
dMDD3~0*Sw3
dMDD4~0*Sw4
dMDD5~0*Sw5

dSw1~0*MDD1         # This estimates the MDD to Sw coupling parameter
dSw2~0*MDD2
dSw3~0*MDD3
dSw4~0*MDD4
dSw5~0*MDD5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sSw                      # This estimates the iMDD sSw covariance
iMDD~~iSw                      # This estimates the iMDD iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sMDD                      # This estimates the iSw sMDD covariance
sSw~~sMDD                      # This estimates the sSw sMDD covariance
'

fit_Sw_MDD_B <- lavaan(Sw_MDD_B, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_MDD_B, fit.measures=T, standardized=T)

#semPaths(fit_Sw_MDD_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/MDD Interpersonal Risk model
```{r Sw/MDD Interpersonal Risk model, echo=FALSE, cache=TRUE}
Sw_MDD_IR <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses Sw2 perfectly on Sw1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on Sw2
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDD2
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSw residual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~C1*Sw1         # This estimates the Sw to MDD coupling parameter
dMDD2~C1*Sw2
dMDD3~C1*Sw3
dMDD4~C1*Sw4
dMDD5~C1*Sw5

dSw1~0*MDD1         # This estimates the MDD to Sw coupling parameter
dSw2~0*MDD2
dSw3~0*MDD3
dSw4~0*MDD4
dSw5~0*MDD5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sSw                      # This estimates the iMDD sSw covariance
iMDD~~iSw                      # This estimates the iMDD iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sMDD                      # This estimates the iSw sMDD covariance
sSw~~sMDD                      # This estimates the sSw sMDD covariance
'

fit_Sw_MDD_IR <- lavaan(Sw_MDD_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_MDD_IR, fit.measures=T, standardized=T)

#fitmeasures(fit_Sw_MDD_IR, fit.measures=c("all"), baseline.model= fit_Sw_MDD_B)

#semPaths(fit_Sw_MDD_IR, 'std', 'est', curvePivot=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/MDD Interpersonal Scar model
```{r Sw/MDD Interpersonal Scar model, echo=FALSE, cache=TRUE}
Sw_MDD_IS <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses PSw_3 perfectly on PSw_1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on PSw_3
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6

dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP100_3
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSw residual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~0*Sw1         # This estimates the Sw to MDD coupling parameter
dMDD2~0*Sw2
dMDD3~0*Sw3
dMDD4~0*Sw4
dMDD5~0*Sw5

dSw1~C2*MDD1         # This estimates the MDD to Sw coupling parameter
dSw2~C2*MDD2
dSw3~C2*MDD3
dSw4~C2*MDD4
dSw5~C2*MDD5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sSw                      # This estimates the iMDD sSw covariance
iMDD~~iSw                      # This estimates the iMDD iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sMDD                      # This estimates the iSw sMDD covariance
sSw~~sMDD                      # This estimates the sSw sMDD covariance
'

fit_Sw_MDD_IS <- lavaan(Sw_MDD_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_MDD_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Sw_MDD_IS, fit.measures=c("all"), baseline.model= fit_Sw_MDD_B)

#semPaths(fit_Sw_MDD_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/MDD Transactional model
```{r Sw/MDD Transactional model, echo=FALSE, cache=TRUE}
Sw_MDD_T <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses PSw_3 perfectly on PSw_1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on PSw_3
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP100_3
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSw residual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~C1*Sw1         # This estimates the Sw to MDD coupling parameter
dMDD2~C1*Sw2
dMDD3~C1*Sw3
dMDD4~C1*Sw4
dMDD5~C1*Sw5

dSw1~C2*MDD1         # This estimates the MDD to Sw coupling parameter
dSw2~C2*MDD2
dSw3~C2*MDD3
dSw4~C2*MDD4
dSw5~C2*MDD5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sSw                      # This estimates the iMDD sSw covariance
iMDD~~iSw                      # This estimates the iMDD iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sMDD                      # This estimates the iSw sMDD covariance
sSw~~sMDD                      # This estimates the sSw sMDD covariance
'

fit_Sw_MDD_T <- lavaan(Sw_MDD_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_MDD_T, fit.measures=T, standardized=T)

#fitmeasures(fit_Sw_MDD_T, fit.measures=c("all"), baseline.model= fit_Sw_MDD_B)

#semPaths(fit_Sw_MDD_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/MDD Developmental change model
```{r Sw/MDD Developmental change model, echo=FALSE, cache=TRUE}
Sw_MDD <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Sw2 ~ 1*Sw1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

MDD2 ~ 1*MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dSw1 =~ 1*Sw2
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dMDD1 =~ 1*MDD2
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSw residual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~Sw1       # This estimates the Sw self-feedback parameter
dSw2~Sw2
dSw3~Sw3
dSw4~Sw4
dSw5~Sw5

dMDD1~MDD1       # This estimates the MDD self-feedback parameter
dMDD2~MDD2
dMDD3~MDD3
dMDD4~MDD4
dMDD5~MDD5

#Estimate coupling parameter
dMDD1~Sw1         # This estimates the Sw to MDD coupling parameter
dMDD2~Sw2
dMDD3~Sw3
dMDD4~Sw4
dMDD5~Sw5

dSw1~MDD1         # This estimates the MDD to Sw coupling parameter
dSw2~MDD2
dSw3~MDD3
dSw4~MDD4
dSw5~MDD5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sSw                      # This estimates the iMDD sSw covariance
iMDD~~iSw                      # This estimates the iMDD iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sMDD                      # This estimates the iSw sMDD covariance
sSw~~sMDD                      # This estimates the sSw sMDD covariance
'

fit_Sw_MDD <- lavaan(Sw_MDD, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_MDD, fit.measures=T, standardized=T)

##anova(fit_Sw_MDD, fit_Sw_MDD_B)

#Figure 1: Theoretical model
#semPaths(fit_Sw_MDD, 'mod', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=4, sizeInt=2, sizeLat=3, intercepts=FALSE, residuals=T)

#Figure 2: Model fit to data
#semPaths(fit_Sw_MDD, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)

#fitmeasures(fit_Sw_MDD, fit.measures=c("all"), baseline.model= fit_Sw_MDD_B)
```



#Bivariate multiwave latent change model for Sw and INTL
###Sw/INTL Baseline model
```{r Sw/INTL Baseline model, echo=FALSE, cache=TRUE}
Sw_INTL_B <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses Sw2 perfectly on Sw1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on Sw2
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL2**
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSwresidual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~0*Sw1         # This estimates the Sw to INTL coupling parameter
dINTL2~0*Sw2
dINTL3~0*Sw3
dINTL4~0*Sw4
dINTL5~0*Sw5

dSw1~0*INTL1         # This estimates the INTL to Sw coupling parameter
dSw2~0*INTL2
dSw3~0*INTL3
dSw4~0*INTL4
dSw5~0*INTL5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sSw                      # This estimates the iINTL sSw covariance
iINTL~~iSw                      # This estimates the iINTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sINTL                      # This estimates the iSw sINTL covariance
sSw~~sINTL                      # This estimates the sSw sINTL covariance
'

fit_Sw_INTL_B <- lavaan(Sw_INTL_B, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_INTL_B, fit.measures=T, standardized=T)

#semPaths(fit_Sw_INTL_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/INTL Interpersonal Risk model
```{r Sw/INTL Interpersonal Risk model, echo=FALSE, cache=TRUE}
Sw_INTL_IR <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses Sw2 perfectly on Sw1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on Sw2
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL2
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSwresidual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~C1*Sw1         # This estimates the Sw to INTL coupling parameter
dINTL2~C1*Sw2
dINTL3~C1*Sw3
dINTL4~C1*Sw4
dINTL5~C1*Sw5

dSw1~0*INTL1         # This estimates the INTL to Sw coupling parameter
dSw2~0*INTL2
dSw3~0*INTL3
dSw4~0*INTL4
dSw5~0*INTL5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sSw                      # This estimates the iINTL sSw covariance
iINTL~~iSw                      # This estimates the iINTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sINTL                      # This estimates the iSw sINTL covariance
sSw~~sINTL                      # This estimates the sSw sINTL covariance
'

fit_Sw_INTL_IR <- lavaan(Sw_INTL_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_INTL_IR, fit.measures=T, standardized=T)

#fitmeasures(fit_Sw_INTL_IR, fit.measures=c("all"), baseline.model= fit_Sw_INTL_B)

#semPaths(fit_Sw_INTL_IR, 'std', 'est', curvePivot=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/INTL Interpersonal Scar model
```{r Sw/INTL Interpersonal Scar model, echo=FALSE, cache=TRUE}
Sw_INTL_IS <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses PSw_3 perfectly on PSw_1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on PSw_3
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6

dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL_3
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSwresidual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~0*Sw1         # This estimates the Sw to INTL coupling parameter
dINTL2~0*Sw2
dINTL3~0*Sw3
dINTL4~0*Sw4
dINTL5~0*Sw5

dSw1~C2*INTL1         # This estimates the INTL to Sw coupling parameter
dSw2~C2*INTL2
dSw3~C2*INTL3
dSw4~C2*INTL4
dSw5~C2*INTL5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sSw                      # This estimates the iINTL sSw covariance
iINTL~~iSw                      # This estimates the iINTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sINTL                      # This estimates the iSw sINTL covariance
sSw~~sINTL                      # This estimates the sSw sINTL covariance
'

fit_Sw_INTL_IS <- lavaan(Sw_INTL_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_INTL_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Sw_INTL_IS, fit.measures=c("all"), baseline.model= fit_Sw_INTL_B)

#semPaths(fit_Sw_INTL_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/INTL Transactional model
```{r Sw/INTL Transactional model, echo=FALSE, cache=TRUE}
Sw_INTL_T <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses PSw_3 perfectly on PSw_1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on PSw_3
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL_3
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSwresidual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~C1*Sw1         # This estimates the Sw to INTL coupling parameter
dINTL2~C1*Sw2
dINTL3~C1*Sw3
dINTL4~C1*Sw4
dINTL5~C1*Sw5

dSw1~C2*INTL1         # This estimates the INTL to Sw coupling parameter
dSw2~C2*INTL2
dSw3~C2*INTL3
dSw4~C2*INTL4
dSw5~C2*INTL5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sSw                      # This estimates the iINTL sSw covariance
iINTL~~iSw                      # This estimates the iINTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sINTL                      # This estimates the iSw sINTL covariance
sSw~~sINTL                      # This estimates the sSw sINTL covariance
'

fit_Sw_INTL_T <- lavaan(Sw_INTL_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_INTL_T, fit.measures=T, standardized=T)

#fitmeasures(fit_Sw_INTL_T, fit.measures=c("all"), baseline.model= fit_Sw_INTL_B)

#semPaths(fit_Sw_INTL_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/INTL Developmental change model
```{r Sw/INTL Developmental change model, echo=FALSE, cache=TRUE}
Sw_INTL <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Sw2 ~ 1*Sw1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

INTL2 ~ 1*INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dSw1 =~ 1*Sw2
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dINTL1 =~ 1*INTL2
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSwresidual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~Sw1       # This estimates the Sw self-feedback parameter
dSw2~Sw2
dSw3~Sw3
dSw4~Sw4
dSw5~Sw5

dINTL1~INTL1       # This estimates the INTL self-feedback parameter
dINTL2~INTL2
dINTL3~INTL3
dINTL4~INTL4
dINTL5~INTL5

#Estimate coupling parameter
dINTL1~Sw1         # This estimates the Sw to INTL coupling parameter
dINTL2~Sw2
dINTL3~Sw3
dINTL4~Sw4
dINTL5~Sw5

dSw1~INTL1         # This estimates the INTL to Sw coupling parameter
dSw2~INTL2
dSw3~INTL3
dSw4~INTL4
dSw5~INTL5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sSw                      # This estimates the iINTL sSw covariance
iINTL~~iSw                      # This estimates the iINTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sINTL                      # This estimates the iSw sINTL covariance
sSw~~sINTL                      # This estimates the sSw sINTL covariance
'

fit_Sw_INTL <- lavaan(Sw_INTL, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_INTL, fit.measures=T, standardized=T)

#fitmeasures(fit_Sw_INTL, fit.measures=c("all"), baseline.model= fit_Sw_INTL_B)

#semPaths(fit_Sw_INTL, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```



#Bivariate multiwave latent change model for Sw and EXTL
###Sw/EXTL Baseline model
```{r Sw/EXTL Baseline model, echo=FALSE, cache=TRUE}
Sw_EXTL_B <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses Sw2 perfectly on Sw1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on Sw2
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL2**
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSwresidual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~0*Sw1         # This estimates the Sw to EXTL coupling parameter
dEXTL2~0*Sw2
dEXTL3~0*Sw3
dEXTL4~0*Sw4
dEXTL5~0*Sw5

dSw1~0*EXTL1         # This estimates the EXTL to Sw coupling parameter
dSw2~0*EXTL2
dSw3~0*EXTL3
dSw4~0*EXTL4
dSw5~0*EXTL5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sSw                      # This estimates the iEXTL sSw covariance
iEXTL~~iSw                      # This estimates the iEXTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sEXTL                      # This estimates the iSw sEXTL covariance
sSw~~sEXTL                      # This estimates the sSw sEXTL covariance
'

fit_Sw_EXTL_B <- lavaan(Sw_EXTL_B, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_EXTL_B, fit.measures=T, standardized=T)

#semPaths(fit_Sw_EXTL_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/EXTL Interpersonal Risk model
```{r Sw/EXTL Interpersonal Risk model, echo=FALSE, cache=TRUE}
Sw_EXTL_IR <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses Sw2 perfectly on Sw1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on Sw2
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL2
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSw residual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSw residual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~C1*Sw1         # This estimates the Sw to EXTL coupling parameter
dEXTL2~C1*Sw2
dEXTL3~C1*Sw3
dEXTL4~C1*Sw4
dEXTL5~C1*Sw5

dSw1~0*EXTL1         # This estimates the EXTL to Sw coupling parameter
dSw2~0*EXTL2
dSw3~0*EXTL3
dSw4~0*EXTL4
dSw5~0*EXTL5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sSw                      # This estimates the iEXTL sSw covariance
iEXTL~~iSw                      # This estimates the iEXTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sEXTL                      # This estimates the iSw sEXTL covariance
sSw~~sEXTL                      # This estimates the sSw sEXTL covariance
'

fit_Sw_EXTL_IR <- lavaan(Sw_EXTL_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_EXTL_IR, fit.measures=T, standardized=T)

#fitmeasures(fit_Sw_EXTL_IR, fit.measures=c("all"), baseline.model= fit_Sw_EXTL_B)

#semPaths(fit_Sw_EXTL_IR, 'std', 'est', curvePivot=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/EXTL Interpersonal Scar model
```{r Sw/EXTL Interpersonal Scar model, echo=FALSE, cache=TRUE}
Sw_EXTL_IS <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses PSw_3 perfectly on PSw_1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on PSw_3
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6

dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL_3
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSwresidual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~0*Sw1         # This estimates the Sw to EXTL coupling parameter
dEXTL2~0*Sw2
dEXTL3~0*Sw3
dEXTL4~0*Sw4
dEXTL5~0*Sw5

dSw1~C2*EXTL1         # This estimates the EXTL to Sw coupling parameter
dSw2~C2*EXTL2
dSw3~C2*EXTL3
dSw4~C2*EXTL4
dSw5~C2*EXTL5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sSw                      # This estimates the iEXTL sSw covariance
iEXTL~~iSw                      # This estimates the iEXTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sEXTL                      # This estimates the iSw sEXTL covariance
sSw~~sEXTL                      # This estimates the sSw sEXTL covariance
'

fit_Sw_EXTL_IS <- lavaan(Sw_EXTL_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_EXTL_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Sw_EXTL_IS, fit.measures=c("all"), baseline.model= fit_Sw_EXTL_B)

#semPaths(fit_Sw_EXTL_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/EXTL Transactional model
```{r Sw/EXTL Transactional model, echo=FALSE, cache=TRUE}
Sw_EXTL_T <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Sw2 ~ 1*Sw1     # This parameter regresses PSw_3 perfectly on PSw_1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dSw1 =~ 1*Sw2        # This defines the change score as measured perfectly by scores on PSw_3
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL_3
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSwresidual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~F1*Sw1       # This estimates the Sw self-feedback parameter
dSw2~F1*Sw2
dSw3~F1*Sw3
dSw4~F1*Sw4
dSw5~F1*Sw5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~C1*Sw1         # This estimates the Sw to EXTL coupling parameter
dEXTL2~C1*Sw2
dEXTL3~C1*Sw3
dEXTL4~C1*Sw4
dEXTL5~C1*Sw5

dSw1~C2*EXTL1         # This estimates the EXTL to Sw coupling parameter
dSw2~C2*EXTL2
dSw3~C2*EXTL3
dSw4~C2*EXTL4
dSw5~C2*EXTL5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sSw                      # This estimates the iEXTL sSw covariance
iEXTL~~iSw                      # This estimates the iEXTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sEXTL                      # This estimates the iSw sEXTL covariance
sSw~~sEXTL                      # This estimates the sSw sEXTL covariance
'

fit_Sw_EXTL_T <- lavaan(Sw_EXTL_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_EXTL_T, fit.measures=T, standardized=T)

#fitmeasures(fit_Sw_EXTL_T, fit.measures=c("all"), baseline.model= fit_Sw_EXTL_B)

#semPaths(fit_Sw_EXTL_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Sw/EXTL Developmental change model
```{r Sw/EXTL Developmental change model, echo=FALSE, cache=TRUE}
Sw_EXTL <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Sw2 ~ 1*Sw1
Sw3 ~ 1*Sw2
Sw4 ~ 1*Sw3
Sw5 ~ 1*Sw4
Sw6 ~ 1*Sw5

EXTL2 ~ 1*EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dSw1 =~ 1*Sw2
dSw2 =~ 1*Sw3
dSw3 =~ 1*Sw4
dSw4 =~ 1*Sw5
dSw5 =~ 1*Sw6
         
dEXTL1 =~ 1*EXTL2
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSwresidual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Sw1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Sw6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dSw1~Sw1       # This estimates the Sw self-feedback parameter
dSw2~Sw2
dSw3~Sw3
dSw4~Sw4
dSw5~Sw5

dEXTL1~EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~EXTL2
dEXTL3~EXTL3
dEXTL4~EXTL4
dEXTL5~EXTL5

#Estimate coupling parameter
dEXTL1~Sw1         # This estimates the Sw to EXTL coupling parameter
dEXTL2~Sw2
dEXTL3~Sw3
dEXTL4~Sw4
dEXTL5~Sw5

dSw1~EXTL1         # This estimates the EXTL to Sw coupling parameter
dSw2~EXTL2
dSw3~EXTL3
dSw4~EXTL4
dSw5~EXTL5

iSw=~1*Sw1                   # This defines the Sw intercept measurement model
sSw=~1*dSw1+ 1*dSw2+ 1*dSw3+ 1*dSw4+ 1*dSw5 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sSw                      # This estimates the iEXTL sSw covariance
iEXTL~~iSw                      # This estimates the iEXTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sEXTL                      # This estimates the iSw sEXTL covariance
sSw~~sEXTL                      # This estimates the sSw sEXTL covariance
'

fit_Sw_EXTL <- lavaan(Sw_EXTL, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Sw_EXTL, fit.measures=T, standardized=T)

#fitmeasures(fit_Sw_EXTL, fit.measures=c("all"), baseline.model= fit_Sw_EXTL_B)

#semPaths(fit_Sw_EXTL, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```





#Bivariate multiwave latent change model for Pro and MDD
###Pro/MDD Baseline model
```{r Pro/MDD Baseline model, echo=FALSE, cache=TRUE}
Pro_MDD_B <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses Pro2 perfectly on Pro1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on Pro2
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP1002
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PPro residual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~0*Pro1         # This estimates the Pro to MDD coupling parameter
dMDD2~0*Pro2
dMDD3~0*Pro3
dMDD4~0*Pro4
dMDD5~0*Pro5

dPro1~0*MDD1         # This estimates the MDD to Pro coupling parameter
dPro2~0*MDD2
dPro3~0*MDD3
dPro4~0*MDD4
dPro5~0*MDD5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPro                      # This estimates the iMDD sPro covariance
iMDD~~iPro                      # This estimates the iMDD iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sMDD                      # This estimates the iPro sMDD covariance
sPro~~sMDD                      # This estimates the sPro sMDD covariance
'

fit_Pro_MDD_B <- lavaan(Pro_MDD_B, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_MDD_B, fit.measures=T, standardized=T)

#semPaths(fit_Pro_MDD_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/MDD Interpersonal Risk model
```{r Pro/MDD Interpersonal Risk model, echo=FALSE, cache=TRUE}
Pro_MDD_IR <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses Pro2 perfectly on Pro1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on Pro2
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDD2
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PPro residual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~C1*Pro1         # This estimates the Pro to MDD coupling parameter
dMDD2~C1*Pro2
dMDD3~C1*Pro3
dMDD4~C1*Pro4
dMDD5~C1*Pro5

dPro1~0*MDD1         # This estimates the MDD to Pro coupling parameter
dPro2~0*MDD2
dPro3~0*MDD3
dPro4~0*MDD4
dPro5~0*MDD5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPro                      # This estimates the iMDD sPro covariance
iMDD~~iPro                      # This estimates the iMDD iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sMDD                      # This estimates the iPro sMDD covariance
sPro~~sMDD                      # This estimates the sPro sMDD covariance
'

fit_Pro_MDD_IR <- lavaan(Pro_MDD_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_MDD_IR, fit.measures=T, standardized=T)

#fitmeasures(fit_Pro_MDD_IR, fit.measures=c("all"), baseline.model= fit_Pro_MDD_B)

#semPaths(fit_Pro_MDD_IR, 'std', 'est', curvePivot=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/MDD Interpersonal Scar model
```{r Pro/MDD Interpersonal Scar model, echo=FALSE, cache=TRUE}
Pro_MDD_IS <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses PPro_3 perfectly on PPro_1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on PPro_3
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6

dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP100_3
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PPro residual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~0*Pro1         # This estimates the Pro to MDD coupling parameter
dMDD2~0*Pro2
dMDD3~0*Pro3
dMDD4~0*Pro4
dMDD5~0*Pro5

dPro1~C2*MDD1         # This estimates the MDD to Pro coupling parameter
dPro2~C2*MDD2
dPro3~C2*MDD3
dPro4~C2*MDD4
dPro5~C2*MDD5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPro                      # This estimates the iMDD sPro covariance
iMDD~~iPro                      # This estimates the iMDD iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sMDD                      # This estimates the iPro sMDD covariance
sPro~~sMDD                      # This estimates the sPro sMDD covariance
'

fit_Pro_MDD_IS <- lavaan(Pro_MDD_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_MDD_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Pro_MDD_IS, fit.measures=c("all"), baseline.model= fit_Pro_MDD_B)

#semPaths(fit_Pro_MDD_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/MDD Transactional model
```{r Pro/MDD Transactional model, echo=FALSE, cache=TRUE}
Pro_MDD_T <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses PPro_3 perfectly on PPro_1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

MDD2 ~ 1*MDD1     # This parameter regresses MDD2 perfectly on MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on PPro_3
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dMDD1 =~ 1*MDD2           # This defines the change score as measured perfectly by scores on MDDPRP100_3
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PPro residual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dMDD1~F2*MDD1       # This estimates the MDD self-feedback parameter
dMDD2~F2*MDD2
dMDD3~F2*MDD3
dMDD4~F2*MDD4
dMDD5~F2*MDD5

#Estimate coupling parameter
dMDD1~C1*Pro1         # This estimates the Pro to MDD coupling parameter
dMDD2~C1*Pro2
dMDD3~C1*Pro3
dMDD4~C1*Pro4
dMDD5~C1*Pro5

dPro1~C2*MDD1         # This estimates the MDD to Pro coupling parameter
dPro2~C2*MDD2
dPro3~C2*MDD3
dPro4~C2*MDD4
dPro5~C2*MDD5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPro                      # This estimates the iMDD sPro covariance
iMDD~~iPro                      # This estimates the iMDD iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sMDD                      # This estimates the iPro sMDD covariance
sPro~~sMDD                      # This estimates the sPro sMDD covariance
'

fit_Pro_MDD_T <- lavaan(Pro_MDD_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_MDD_T, fit.measures=T, standardized=T)

#fitmeasures(fit_Pro_MDD_T, fit.measures=c("all"), baseline.model= fit_Pro_MDD_B)

#semPaths(fit_Pro_MDD_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/MDD Developmental change model
```{r Pro/MDD Developmental change model, echo=FALSE, cache=TRUE}
Pro_MDD <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Define regressions
Pro2 ~ 1*Pro1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

MDD2 ~ 1*MDD1
MDD3 ~ 1*MDD2
MDD4 ~ 1*MDD3
MDD5 ~ 1*MDD4
MDD6 ~ 1*MDD5

#Define the change score
dPro1 =~ 1*Pro2
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dMDD1 =~ 1*MDD2
dMDD2 =~ 1*MDD3           
dMDD3 =~ 1*MDD4
dMDD4 =~ 1*MDD5
dMDD5 =~ 1*MDD6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PPro residual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

MDD1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
MDD6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~Pro1       # This estimates the Pro self-feedback parameter
dPro2~Pro2
dPro3~Pro3
dPro4~Pro4
dPro5~Pro5

dMDD1~MDD1       # This estimates the MDD self-feedback parameter
dMDD2~MDD2
dMDD3~MDD3
dMDD4~MDD4
dMDD5~MDD5

#Estimate coupling parameter
dMDD1~Pro1         # This estimates the Pro to MDD coupling parameter
dMDD2~Pro2
dMDD3~Pro3
dMDD4~Pro4
dMDD5~Pro5

dPro1~MDD1         # This estimates the MDD to Pro coupling parameter
dPro2~MDD2
dPro3~MDD3
dPro4~MDD4
dPro5~MDD5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iMDD=~1*MDD1                   # This defines the MDD intercept measurement model
sMDD=~1*dMDD1+ 1*dMDD2+ 1*dMDD3+ 1*dMDD4+ 1*dMDD5 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPro                      # This estimates the iMDD sPro covariance
iMDD~~iPro                      # This estimates the iMDD iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sMDD                      # This estimates the iPro sMDD covariance
sPro~~sMDD                      # This estimates the sPro sMDD covariance
'

fit_Pro_MDD <- lavaan(Pro_MDD, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_MDD, fit.measures=T, standardized=T)

#Figure 1: Theoretical model
#semPaths(fit_Pro_MDD, 'mod', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=4, sizeInt=2, sizeLat=3, intercepts=FALSE, residuals=T)

#Figure 2: Model fit to data
#semPaths(fit_Pro_MDD, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)

#fitmeasures(fit_Pro_MDD, fit.measures=c("all"), baseline.model= fit_Pro_MDD_B)
```



#Bivariate multiwave latent change model for Pro and INTL
###Pro/INTL Baseline model
```{r Pro/INTL Baseline model, echo=FALSE, cache=TRUE}
Pro_INTL_B <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses Pro2 perfectly on Pro1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on Pro2
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL2**
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PProresidual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~0*Pro1         # This estimates the Pro to INTL coupling parameter
dINTL2~0*Pro2
dINTL3~0*Pro3
dINTL4~0*Pro4
dINTL5~0*Pro5

dPro1~0*INTL1         # This estimates the INTL to Pro coupling parameter
dPro2~0*INTL2
dPro3~0*INTL3
dPro4~0*INTL4
dPro5~0*INTL5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPro                      # This estimates the iINTL sPro covariance
iINTL~~iPro                      # This estimates the iINTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sINTL                      # This estimates the iPro sINTL covariance
sPro~~sINTL                      # This estimates the sPro sINTL covariance
'

fit_Pro_INTL_B <- lavaan(Pro_INTL_B, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_INTL_B, fit.measures=T, standardized=T)

#semPaths(fit_Pro_INTL_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/INTL Interpersonal Risk model
```{r Pro/INTL Interpersonal Risk model, echo=FALSE, cache=TRUE}
Pro_INTL_IR <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses Pro2 perfectly on Pro1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on Pro2
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL2
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PProresidual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~C1*Pro1         # This estimates the Pro to INTL coupling parameter
dINTL2~C1*Pro2
dINTL3~C1*Pro3
dINTL4~C1*Pro4
dINTL5~C1*Pro5

dPro1~0*INTL1         # This estimates the INTL to Pro coupling parameter
dPro2~0*INTL2
dPro3~0*INTL3
dPro4~0*INTL4
dPro5~0*INTL5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPro                      # This estimates the iINTL sPro covariance
iINTL~~iPro                      # This estimates the iINTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sINTL                      # This estimates the iPro sINTL covariance
sPro~~sINTL                      # This estimates the sPro sINTL covariance
'

fit_Pro_INTL_IR <- lavaan(Pro_INTL_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_INTL_IR, fit.measures=T, standardized=T)

#anova(fit_Pro_INTL_IR, fit_Pro_INTL_B)

#modificationindices(fit_Pro_INTL_IR, standardized = T, power = T)

#fitmeasures(fit_Pro_INTL_IR, fit.measures=c("all"), baseline.model= fit_Pro_INTL_B)

#semPaths(fit_Pro_INTL_IR, 'std', 'est', curvePivot=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/INTL Interpersonal Scar model
```{r Pro/INTL Interpersonal Scar model, echo=FALSE, cache=TRUE}
Pro_INTL_IS <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses PPro_3 perfectly on PPro_1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on PPro_3
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6

dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL_3
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PProresidual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~0*Pro1         # This estimates the Pro to INTL coupling parameter
dINTL2~0*Pro2
dINTL3~0*Pro3
dINTL4~0*Pro4
dINTL5~0*Pro5

dPro1~C2*INTL1         # This estimates the INTL to Pro coupling parameter
dPro2~C2*INTL2
dPro3~C2*INTL3
dPro4~C2*INTL4
dPro5~C2*INTL5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPro                      # This estimates the iINTL sPro covariance
iINTL~~iPro                      # This estimates the iINTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sINTL                      # This estimates the iPro sINTL covariance
sPro~~sINTL                      # This estimates the sPro sINTL covariance
'

fit_Pro_INTL_IS <- lavaan(Pro_INTL_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_INTL_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Pro_INTL_IS, fit.measures=c("all"), baseline.model= fit_Pro_INTL_B)

#semPaths(fit_Pro_INTL_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/INTL Transactional model
```{r Pro/INTL Transactional model, echo=FALSE, cache=TRUE}
Pro_INTL_T <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses PPro_3 perfectly on PPro_1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

INTL2 ~ 1*INTL1     # This parameter regresses INTL2 perfectly on INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on PPro_3
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dINTL1 =~ 1*INTL2           # This defines the change score as measured perfectly by scores on INTL_3
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PProresidual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dINTL1~F2*INTL1       # This estimates the INTL self-feedback parameter
dINTL2~F2*INTL2
dINTL3~F2*INTL3
dINTL4~F2*INTL4
dINTL5~F2*INTL5

#Estimate coupling parameter
dINTL1~C1*Pro1         # This estimates the Pro to INTL coupling parameter
dINTL2~C1*Pro2
dINTL3~C1*Pro3
dINTL4~C1*Pro4
dINTL5~C1*Pro5

dPro1~C2*INTL1         # This estimates the INTL to Pro coupling parameter
dPro2~C2*INTL2
dPro3~C2*INTL3
dPro4~C2*INTL4
dPro5~C2*INTL5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPro                      # This estimates the iINTL sPro covariance
iINTL~~iPro                      # This estimates the iINTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sINTL                      # This estimates the iPro sINTL covariance
sPro~~sINTL                      # This estimates the sPro sINTL covariance
'

fit_Pro_INTL_T <- lavaan(Pro_INTL_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_INTL_T, fit.measures=T, standardized=T)

#fitmeasures(fit_Pro_INTL_T, fit.measures=c("all"), baseline.model= fit_Pro_INTL_B)

#semPaths(fit_Pro_INTL_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/INTL Developmental change model
```{r Pro/INTL Developmental change model, echo=FALSE, cache=TRUE}
Pro_INTL <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Define regressions
Pro2 ~ 1*Pro1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

INTL2 ~ 1*INTL1
INTL3 ~ 1*INTL2
INTL4 ~ 1*INTL3
INTL5 ~ 1*INTL4
INTL6 ~ 1*INTL5

#Define the change score
dPro1 =~ 1*Pro2
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dINTL1 =~ 1*INTL2
dINTL2 =~ 1*INTL3           
dINTL3 =~ 1*INTL4
dINTL4 =~ 1*INTL5
dINTL5 =~ 1*INTL6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PProresidual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

INTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
INTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~Pro1       # This estimates the Pro self-feedback parameter
dPro2~Pro2
dPro3~Pro3
dPro4~Pro4
dPro5~Pro5

dINTL1~INTL1       # This estimates the INTL self-feedback parameter
dINTL2~INTL2
dINTL3~INTL3
dINTL4~INTL4
dINTL5~INTL5

#Estimate coupling parameter
dINTL1~Pro1         # This estimates the Pro to INTL coupling parameter
dINTL2~Pro2
dINTL3~Pro3
dINTL4~Pro4
dINTL5~Pro5

dPro1~INTL1         # This estimates the INTL to Pro coupling parameter
dPro2~INTL2
dPro3~INTL3
dPro4~INTL4
dPro5~INTL5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iINTL=~1*INTL1                   # This defines the INTL intercept measurement model
sINTL=~1*dINTL1+ 1*dINTL2+ 1*dINTL3+ 1*dINTL4+ 1*dINTL5 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPro                      # This estimates the iINTL sPro covariance
iINTL~~iPro                      # This estimates the iINTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sINTL                      # This estimates the iPro sINTL covariance
sPro~~sINTL                      # This estimates the sPro sINTL covariance
'

fit_Pro_INTL <- lavaan(Pro_INTL, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_INTL, fit.measures=T, standardized=T)

#fitmeasures(fit_Pro_INTL, fit.measures=c("all"), baseline.model= fit_Pro_INTL_B)

#semPaths(fit_Pro_INTL, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```




#Bivariate multiwave latent change model for Pro and EXTL
###Pro/EXTL Baseline model
```{r Pro/EXTL Baseline model, echo=FALSE, cache=TRUE}
Pro_EXTL_B <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses Pro2 perfectly on Pro1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on Pro2
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL2**
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PProresidual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~0*Pro1         # This estimates the Pro to EXTL coupling parameter
dEXTL2~0*Pro2
dEXTL3~0*Pro3
dEXTL4~0*Pro4
dEXTL5~0*Pro5

dPro1~0*EXTL1         # This estimates the EXTL to Pro coupling parameter
dPro2~0*EXTL2
dPro3~0*EXTL3
dPro4~0*EXTL4
dPro5~0*EXTL5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPro                      # This estimates the iEXTL sPro covariance
iEXTL~~iPro                      # This estimates the iEXTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sEXTL                      # This estimates the iPro sEXTL covariance
sPro~~sEXTL                      # This estimates the sPro sEXTL covariance
'

fit_Pro_EXTL_B <- lavaan(Pro_EXTL_B, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_EXTL_B, fit.measures=T, standardized=T)

#semPaths(fit_Pro_EXTL_B, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/EXTL Interpersonal Risk model
```{r Pro/EXTL Interpersonal Risk model, echo=FALSE, cache=TRUE}
Pro_EXTL_IR <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses Pro2 perfectly on Pro1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on Pro2
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL2
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PPro residual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TPro residual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~C1*Pro1         # This estimates the Pro to EXTL coupling parameter
dEXTL2~C1*Pro2
dEXTL3~C1*Pro3
dEXTL4~C1*Pro4
dEXTL5~C1*Pro5

dPro1~0*EXTL1         # This estimates the EXTL to Pro coupling parameter
dPro2~0*EXTL2
dPro3~0*EXTL3
dPro4~0*EXTL4
dPro5~0*EXTL5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPro                      # This estimates the iEXTL sPro covariance
iEXTL~~iPro                      # This estimates the iEXTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sEXTL                      # This estimates the iPro sEXTL covariance
sPro~~sEXTL                      # This estimates the sPro sEXTL covariance
'

fit_Pro_EXTL_IR <- lavaan(Pro_EXTL_IR, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_EXTL_IR, fit.measures=T, standardized=T)

#fitmeasures(fit_Pro_EXTL_IR, fit.measures=c("all"), baseline.model= fit_Pro_EXTL_B)

#semPaths(fit_Pro_EXTL_IR, 'std', 'est', curvePivot=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/EXTL Interpersonal Scar model
```{r Pro/EXTL Interpersonal Scar model, echo=FALSE, cache=TRUE}
Pro_EXTL_IS <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses PPro_3 perfectly on PPro_1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on PPro_3
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6

dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL_3
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PProresidual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~0*Pro1         # This estimates the Pro to EXTL coupling parameter
dEXTL2~0*Pro2
dEXTL3~0*Pro3
dEXTL4~0*Pro4
dEXTL5~0*Pro5

dPro1~C2*EXTL1         # This estimates the EXTL to Pro coupling parameter
dPro2~C2*EXTL2
dPro3~C2*EXTL3
dPro4~C2*EXTL4
dPro5~C2*EXTL5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPro                      # This estimates the iEXTL sPro covariance
iEXTL~~iPro                      # This estimates the iEXTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sEXTL                      # This estimates the iPro sEXTL covariance
sPro~~sEXTL                      # This estimates the sPro sEXTL covariance
'

fit_Pro_EXTL_IS <- lavaan(Pro_EXTL_IS, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_EXTL_IS, fit.measures=T, standardized=T)

#fitmeasures(fit_Pro_EXTL_IS, fit.measures=c("all"), baseline.model= fit_Pro_EXTL_B)

#semPaths(fit_Pro_EXTL_IS, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/EXTL Transactional model
```{r Pro/EXTL Transactional model, echo=FALSE, cache=TRUE}
Pro_EXTL_T <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Pro2 ~ 1*Pro1     # This parameter regresses PPro_3 perfectly on PPro_1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

EXTL2 ~ 1*EXTL1     # This parameter regresses EXTL2 perfectly on EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dPro1 =~ 1*Pro2        # This defines the change score as measured perfectly by scores on PPro_3
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dEXTL1 =~ 1*EXTL2           # This defines the change score as measured perfectly by scores on EXTL_3
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PProresidual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~F1*Pro1       # This estimates the Pro self-feedback parameter
dPro2~F1*Pro2
dPro3~F1*Pro3
dPro4~F1*Pro4
dPro5~F1*Pro5

dEXTL1~F2*EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~F2*EXTL2
dEXTL3~F2*EXTL3
dEXTL4~F2*EXTL4
dEXTL5~F2*EXTL5

#Estimate coupling parameter
dEXTL1~C1*Pro1         # This estimates the Pro to EXTL coupling parameter
dEXTL2~C1*Pro2
dEXTL3~C1*Pro3
dEXTL4~C1*Pro4
dEXTL5~C1*Pro5

dPro1~C2*EXTL1         # This estimates the EXTL to Pro coupling parameter
dPro2~C2*EXTL2
dPro3~C2*EXTL3
dPro4~C2*EXTL4
dPro5~C2*EXTL5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPro                      # This estimates the iEXTL sPro covariance
iEXTL~~iPro                      # This estimates the iEXTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sEXTL                      # This estimates the iPro sEXTL covariance
sPro~~sEXTL                      # This estimates the sPro sEXTL covariance
'

fit_Pro_EXTL_T <- lavaan(Pro_EXTL_T, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_EXTL_T, fit.measures=T, standardized=T)

#fitmeasures(fit_Pro_EXTL_T, fit.measures=c("all"), baseline.model= fit_Pro_EXTL_B)

#semPaths(fit_Pro_EXTL_T, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```

###Pro/EXTL Developmental change model
```{r Pro/EXTL Developmental change model, echo=FALSE, cache=TRUE}
Pro_EXTL <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Define regressions
Pro2 ~ 1*Pro1
Pro3 ~ 1*Pro2
Pro4 ~ 1*Pro3
Pro5 ~ 1*Pro4
Pro6 ~ 1*Pro5

EXTL2 ~ 1*EXTL1
EXTL3 ~ 1*EXTL2
EXTL4 ~ 1*EXTL3
EXTL5 ~ 1*EXTL4
EXTL6 ~ 1*EXTL5

#Define the change score
dPro1 =~ 1*Pro2
dPro2 =~ 1*Pro3
dPro3 =~ 1*Pro4
dPro4 =~ 1*Pro5
dPro5 =~ 1*Pro6
         
dEXTL1 =~ 1*EXTL2
dEXTL2 =~ 1*EXTL3           
dEXTL3 =~ 1*EXTL4
dEXTL4 =~ 1*EXTL5
dEXTL5 =~ 1*EXTL6

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PProresidual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


#Covariates
Pro1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
Pro6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP

EXTL1 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL2 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL3 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL4 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL5 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
EXTL6 ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP


#Dynamics

#Estimate the self-feedback parameters
dPro1~Pro1       # This estimates the Pro self-feedback parameter
dPro2~Pro2
dPro3~Pro3
dPro4~Pro4
dPro5~Pro5

dEXTL1~EXTL1       # This estimates the EXTL self-feedback parameter
dEXTL2~EXTL2
dEXTL3~EXTL3
dEXTL4~EXTL4
dEXTL5~EXTL5

#Estimate coupling parameter
dEXTL1~Pro1         # This estimates the Pro to EXTL coupling parameter
dEXTL2~Pro2
dEXTL3~Pro3
dEXTL4~Pro4
dEXTL5~Pro5

dPro1~EXTL1         # This estimates the EXTL to Pro coupling parameter
dPro2~EXTL2
dPro3~EXTL3
dPro4~EXTL4
dPro5~EXTL5

iPro=~1*Pro1                   # This defines the Pro intercept measurement model
sPro=~1*dPro1+ 1*dPro2+ 1*dPro3+ 1*dPro4+ 1*dPro5 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iEXTL=~1*EXTL1                   # This defines the EXTL intercept measurement model
sEXTL=~1*dEXTL1+ 1*dEXTL2+ 1*dEXTL3+ 1*dEXTL4+ 1*dEXTL5 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPro                      # This estimates the iEXTL sPro covariance
iEXTL~~iPro                      # This estimates the iEXTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sEXTL                      # This estimates the iPro sEXTL covariance
sPro~~sEXTL                      # This estimates the sPro sEXTL covariance
'

fit_Pro_EXTL <- lavaan(Pro_EXTL, data=data_wide, missing="FIML", estimator="MLR")

#summary(fit_Pro_EXTL, fit.measures=T, standardized=T)

#fitmeasures(fit_Pro_EXTL, fit.measures=c("all"), baseline.model= fit_Pro_EXTL_B)

#semPaths(fit_Pro_EXTL, 'std', 'est', curveAdjacent=T, layout="tree", orthogonal=T, rescale=T,
#         label.cex=T, label.scale=T, normalize=FALSE, sizeMan=3, sizeInt=1, sizeLat=3, intercepts=FALSE)
```


##Model comparisons
```{r Model comparison, echo=FALSE, eval=FALSE}
###Peer/MDD Model comparison
Peer_MDD_comparison <- matrix(ncol=6,nrow=7)
Peer_MDD_comparison <- as.data.frame(Peer_MDD_comparison)
Peer_MDD_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Peer_MDD_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Peer_MDD_comparison[,2] <- fitmeasures(fit_Peer_MDD_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_MDD_comparison[,3] <- fitmeasures(fit_Peer_MDD_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_MDD_comparison[,4] <- fitmeasures(fit_Peer_MDD_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_MDD_comparison[,5] <- fitmeasures(fit_Peer_MDD_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_MDD_comparison[,6] <- fitmeasures(fit_Peer_MDD, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Peer_MDD_comparison[,2:6] <- round(Peer_MDD_comparison[,2:6], digits=3)


###Peer/INTL Model comparison
Peer_INTL_comparison <- matrix(ncol=6,nrow=7)
Peer_INTL_comparison <- as.data.frame(Peer_INTL_comparison)
Peer_INTL_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Peer_INTL_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Peer_INTL_comparison[,2] <- fitmeasures(fit_Peer_INTL_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_INTL_comparison[,3] <- fitmeasures(fit_Peer_INTL_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_INTL_comparison[,4] <- fitmeasures(fit_Peer_INTL_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_INTL_comparison[,5] <- fitmeasures(fit_Peer_INTL_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_INTL_comparison[,6] <- fitmeasures(fit_Peer_INTL, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Peer_INTL_comparison[,2:6] <- round(Peer_INTL_comparison[,2:6], digits=3)


###Peer/EXTL Model comparison
Peer_EXTL_comparison <- matrix(ncol=6,nrow=7)
Peer_EXTL_comparison <- as.data.frame(Peer_EXTL_comparison)
Peer_EXTL_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Peer_EXTL_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Peer_EXTL_comparison[,2] <- fitmeasures(fit_Peer_EXTL_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_EXTL_comparison[,3] <- fitmeasures(fit_Peer_EXTL_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_EXTL_comparison[,4] <- fitmeasures(fit_Peer_EXTL_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_EXTL_comparison[,5] <- fitmeasures(fit_Peer_EXTL_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Peer_EXTL_comparison[,6] <- fitmeasures(fit_Peer_EXTL, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Peer_EXTL_comparison[,2:6] <- round(Peer_EXTL_comparison[,2:6], digits=3)


###Agg/MDD Model comparison
Agg_MDD_comparison <- matrix(ncol=6,nrow=7)
Agg_MDD_comparison <- as.data.frame(Agg_MDD_comparison)
Agg_MDD_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Agg_MDD_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Agg_MDD_comparison[,2] <- fitmeasures(fit_Agg_MDD_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_MDD_comparison[,3] <- fitmeasures(fit_Agg_MDD_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_MDD_comparison[,4] <- fitmeasures(fit_Agg_MDD_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_MDD_comparison[,5] <- fitmeasures(fit_Agg_MDD_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_MDD_comparison[,6] <- fitmeasures(fit_Agg_MDD, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Agg_MDD_comparison[,2:6] <- round(Agg_MDD_comparison[,2:6], digits=3)


###Agg/INTL Model comparison
Agg_INTL_comparison <- matrix(ncol=6,nrow=7)
Agg_INTL_comparison <- as.data.frame(Agg_INTL_comparison)
Agg_INTL_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Agg_INTL_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Agg_INTL_comparison[,2] <- fitmeasures(fit_Agg_INTL_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_INTL_comparison[,3] <- fitmeasures(fit_Agg_INTL_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_INTL_comparison[,4] <- fitmeasures(fit_Agg_INTL_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_INTL_comparison[,5] <- fitmeasures(fit_Agg_INTL_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_INTL_comparison[,6] <- fitmeasures(fit_Agg_INTL, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Agg_INTL_comparison[,2:6] <- round(Agg_INTL_comparison[,2:6], digits=3)


###Agg/EXTL Model comparison
Agg_EXTL_comparison <- matrix(ncol=6,nrow=7)
Agg_EXTL_comparison <- as.data.frame(Agg_EXTL_comparison)
Agg_EXTL_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Agg_EXTL_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Agg_EXTL_comparison[,2] <- fitmeasures(fit_Agg_EXTL_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_EXTL_comparison[,3] <- fitmeasures(fit_Agg_EXTL_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_EXTL_comparison[,4] <- fitmeasures(fit_Agg_EXTL_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_EXTL_comparison[,5] <- fitmeasures(fit_Agg_EXTL_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Agg_EXTL_comparison[,6] <- fitmeasures(fit_Agg_EXTL, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Agg_EXTL_comparison[,2:6] <- round(Agg_EXTL_comparison[,2:6], digits=3)


###Sw/MDD Model comparison
Sw_MDD_comparison <- matrix(ncol=6,nrow=7)
Sw_MDD_comparison <- as.data.frame(Sw_MDD_comparison)
Sw_MDD_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Sw_MDD_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Sw_MDD_comparison[,2] <- fitmeasures(fit_Sw_MDD_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_MDD_comparison[,3] <- fitmeasures(fit_Sw_MDD_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_MDD_comparison[,4] <- fitmeasures(fit_Sw_MDD_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_MDD_comparison[,5] <- fitmeasures(fit_Sw_MDD_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_MDD_comparison[,6] <- fitmeasures(fit_Sw_MDD, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Sw_MDD_comparison[,2:6] <- round(Sw_MDD_comparison[,2:6], digits=3)


###Sw/INTL Model comparison
Sw_INTL_comparison <- matrix(ncol=6,nrow=7)
Sw_INTL_comparison <- as.data.frame(Sw_INTL_comparison)
Sw_INTL_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Sw_INTL_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Sw_INTL_comparison[,2] <- fitmeasures(fit_Sw_INTL_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_INTL_comparison[,3] <- fitmeasures(fit_Sw_INTL_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_INTL_comparison[,4] <- fitmeasures(fit_Sw_INTL_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_INTL_comparison[,5] <- fitmeasures(fit_Sw_INTL_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_INTL_comparison[,6] <- fitmeasures(fit_Sw_INTL, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Sw_INTL_comparison[,2:6] <- round(Sw_INTL_comparison[,2:6], digits=3)


###Sw/EXTL Model comparison
Sw_EXTL_comparison <- matrix(ncol=6,nrow=7)
Sw_EXTL_comparison <- as.data.frame(Sw_EXTL_comparison)
Sw_EXTL_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Sw_EXTL_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Sw_EXTL_comparison[,2] <- fitmeasures(fit_Sw_EXTL_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_EXTL_comparison[,3] <- fitmeasures(fit_Sw_EXTL_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_EXTL_comparison[,4] <- fitmeasures(fit_Sw_EXTL_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_EXTL_comparison[,5] <- fitmeasures(fit_Sw_EXTL_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Sw_EXTL_comparison[,6] <- fitmeasures(fit_Sw_EXTL, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Sw_EXTL_comparison[,2:6] <- round(Sw_EXTL_comparison[,2:6], digits=3)


###Pro/MDD Model comparison
Pro_MDD_comparison <- matrix(ncol=6,nrow=7)
Pro_MDD_comparison <- as.data.frame(Pro_MDD_comparison)
Pro_MDD_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Pro_MDD_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Pro_MDD_comparison[,2] <- fitmeasures(fit_Pro_MDD_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_MDD_comparison[,3] <- fitmeasures(fit_Pro_MDD_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_MDD_comparison[,4] <- fitmeasures(fit_Pro_MDD_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_MDD_comparison[,5] <- fitmeasures(fit_Pro_MDD_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_MDD_comparison[,6] <- fitmeasures(fit_Pro_MDD, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Pro_MDD_comparison[,2:6] <- round(Pro_MDD_comparison[,2:6], digits=3)


###Pro/INTL Model comparison
Pro_INTL_comparison <- matrix(ncol=6,nrow=7)
Pro_INTL_comparison <- as.data.frame(Pro_INTL_comparison)
Pro_INTL_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Pro_INTL_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Pro_INTL_comparison[,2] <- fitmeasures(fit_Pro_INTL_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_INTL_comparison[,3] <- fitmeasures(fit_Pro_INTL_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_INTL_comparison[,4] <- fitmeasures(fit_Pro_INTL_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_INTL_comparison[,5] <- fitmeasures(fit_Pro_INTL_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_INTL_comparison[,6] <- fitmeasures(fit_Pro_INTL, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Pro_INTL_comparison[,2:6] <- round(Pro_INTL_comparison[,2:6], digits=3)


###Pro/EXTL Model comparison
Pro_EXTL_comparison <- matrix(ncol=6,nrow=7)
Pro_EXTL_comparison <- as.data.frame(Pro_EXTL_comparison)
Pro_EXTL_comparison[,1] <- c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr")
colnames(Pro_EXTL_comparison) <- c("Fit_Statistics","Baseline","Interpersonal_Scar","Interpersonal_Risk","Transactional","Developmental")

Pro_EXTL_comparison[,2] <- fitmeasures(fit_Pro_EXTL_B, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_EXTL_comparison[,3] <- fitmeasures(fit_Pro_EXTL_IS, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_EXTL_comparison[,4] <- fitmeasures(fit_Pro_EXTL_IR, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_EXTL_comparison[,5] <- fitmeasures(fit_Pro_EXTL_T, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))
Pro_EXTL_comparison[,6] <- fitmeasures(fit_Pro_EXTL, fit.measures=c("chisq","cfi.robust","rmsea.robust","logl","bic","aic","srmr"))

Pro_EXTL_comparison[,2:6] <- round(Pro_EXTL_comparison[,2:6], digits=3)

Peer_MDD_comparison
Peer_INTL_comparison
Peer_EXTL_comparison
Agg_MDD_comparison
Agg_INTL_comparison
Agg_EXTL_comparison
Sw_MDD_comparison
Sw_INTL_comparison
Sw_EXTL_comparison
Pro_MDD_comparison
Pro_INTL_comparison
Pro_EXTL_comparison
```


## Model Tables
```{r Model Tables, echo=FALSE}
list_of_fit_stats <- c("npar","df","logl","chisq","cfi.robust","rmsea.robust","srmr","aic","bic")

#Peer_MDD
# Make table of fit statistics
fitstats_Peer_MDD <- as.data.frame(matrix(ncol=11,nrow=10))
colnames(fitstats_Peer_MDD) <- c("Model_Parameters","Peer_B","MDD_B","Peer_IS","MDD_IS","Peer_IR","MDD_IR","Peer_T","MDD_T","Peer_D","MDD_D")
fitstats_Peer_MDD[,1] <- c(list_of_fit_stats,"∆χ2 to baseline")
fitstats_Peer_MDD[,2:3] <- c(fitmeasures(fit_Peer_MDD_B, fit.measures=list_of_fit_stats),"--")
fitstats_Peer_MDD[,4:5] <- c(fitmeasures(fit_Peer_MDD_IS, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IS)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IS)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IS)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IS)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IS)[2,5],2)))))
fitstats_Peer_MDD[,6:7] <- c(fitmeasures(fit_Peer_MDD_IR, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IR)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IR)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IR)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IR)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IR)[2,5],2)))))
fitstats_Peer_MDD[,8:9] <- c(fitmeasures(fit_Peer_MDD_T, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_T)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_T)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_T)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_T)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_T)[2,5],2)))))
fitstats_Peer_MDD[,10:11] <- c(fitmeasures(fit_Peer_MDD, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD)[2,5],2)))))
fitstats_Peer_MDD[,2:11] <- apply(fitstats_Peer_MDD[,2:11], 2, as.numeric)
fitstats_Peer_MDD[c(1:4,8:9),2:11] <- round(fitstats_Peer_MDD[c(1:4,8:9),2:11], 0)
fitstats_Peer_MDD[5:7,2:11] <- round(fitstats_Peer_MDD[5:7,2:11], 3)
fitstats_Peer_MDD <- as.data.frame(fitstats_Peer_MDD)
fitstats_Peer_MDD[,1] <- c("Parameters","Df","Log Likelihood","χ2","CFI","RMSEA","SRMR","AIC","BIC","∆χ2 to Baseline")

# Make table of parameters
# Select only the necessary parameters, removing the 'label', 'se', and 'z' columns
out_Peer_MDD_B <- parameterEstimates(fit_Peer_MDD_B)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Peer_MDD_B) <- seq(length=nrow(out_Peer_MDD_B))

out_Peer_MDD_IS <- parameterEstimates(fit_Peer_MDD_IS)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Peer_MDD_IS) <- seq(length=nrow(out_Peer_MDD_IS))

out_Peer_MDD_IR <- parameterEstimates(fit_Peer_MDD_IR)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Peer_MDD_IR) <- seq(length=nrow(out_Peer_MDD_IR))

out_Peer_MDD_T <- parameterEstimates(fit_Peer_MDD_T)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Peer_MDD_T) <- seq(length=nrow(out_Peer_MDD_T))

out_Peer_MDD <- parameterEstimates(fit_Peer_MDD)[c(129:148,155:158,165:168,169:174),] %>%
  select(-se,-z) %>%
    mutate(est = round(est,3))
rownames(out_Peer_MDD) <- seq(length=nrow(out_Peer_MDD))

# Create blank output table
parameters_Peer_MDD <- NULL
parameters_Peer_MDD$Model_Parameters <- c("Intercept mean","Slope mean","Self-feedback","Coupling",
                        "Intercept Variance","Slope Variance","Correlation ρ01",
                        "Correlation ρp0m0","Correlation ρp1m1",
                        "Correlation ρp0m1","Correlation ρp1m0")
# Fill the table with the appropriate values
parameters_Peer_MDD$Peer_B <- c(out_Peer_MDD_B[21,4],out_Peer_MDD_B[23,4],out_Peer_MDD_B[1,4],out_Peer_MDD_B[11,4],
                     out_Peer_MDD_B[22,4],out_Peer_MDD_B[24,4],out_Peer_MDD_B[32,4],
                     out_Peer_MDD_B[31,4],out_Peer_MDD_B[34,4],
                     out_Peer_MDD_B[33,4],out_Peer_MDD_B[30,4])
parameters_Peer_MDD$Peer_IS <- c(out_Peer_MDD_IS[21,4],out_Peer_MDD_IS[23,4],out_Peer_MDD_IS[1,4],out_Peer_MDD_IS[11,4],
                     out_Peer_MDD_IS[22,4],out_Peer_MDD_IS[24,4],out_Peer_MDD_IS[32,4],
                     out_Peer_MDD_IS[31,4],out_Peer_MDD_IS[34,4],
                     out_Peer_MDD_IS[33,4],out_Peer_MDD_IS[30,4])
parameters_Peer_MDD$Peer_IR <- c(out_Peer_MDD_IR[21,4],out_Peer_MDD_IR[23,4],out_Peer_MDD_IR[1,4],out_Peer_MDD_IR[11,4],
                     out_Peer_MDD_IR[22,4],out_Peer_MDD_IR[24,4],out_Peer_MDD_IR[32,4],
                     out_Peer_MDD_IR[31,4],out_Peer_MDD_IR[34,4],
                     out_Peer_MDD_IR[33,4],out_Peer_MDD_IR[30,4])
parameters_Peer_MDD$Peer_T <- c(out_Peer_MDD_T[21,4],out_Peer_MDD_T[23,4],out_Peer_MDD_T[1,4],out_Peer_MDD_T[11,4],
                     out_Peer_MDD_T[22,4],out_Peer_MDD_T[24,4],out_Peer_MDD_T[32,4],
                     out_Peer_MDD_T[31,4],out_Peer_MDD_T[34,4],
                     out_Peer_MDD_T[33,4],out_Peer_MDD_T[30,4])
parameters_Peer_MDD$Peer_D <- c(out_Peer_MDD[21,4],out_Peer_MDD[23,4],out_Peer_MDD[1,4],mean(as.numeric(out_Peer_MDD[11:15,4])),
                     out_Peer_MDD[22,4],out_Peer_MDD[24,4],out_Peer_MDD[32,4],
                     out_Peer_MDD[31,4],out_Peer_MDD[34,4],
                     out_Peer_MDD[33,4],out_Peer_MDD[30,4])

parameters_Peer_MDD$MDD_B <- c(out_Peer_MDD_B[25,4],out_Peer_MDD_B[27,4],out_Peer_MDD_B[6,4],out_Peer_MDD_B[16,4],
                     out_Peer_MDD_B[26,4],out_Peer_MDD_B[28,4],out_Peer_MDD_B[29,4],
                     out_Peer_MDD_B[31,4],out_Peer_MDD_B[34,4],
                     out_Peer_MDD_B[33,4],out_Peer_MDD_B[30,4])
parameters_Peer_MDD$MDD_IS <- c(out_Peer_MDD_IS[25,4],out_Peer_MDD_IS[27,4],out_Peer_MDD_IS[6,4],out_Peer_MDD_IS[16,4],
                     out_Peer_MDD_IS[26,4],out_Peer_MDD_IS[28,4],out_Peer_MDD_IS[29,4],
                     out_Peer_MDD_IS[31,4],out_Peer_MDD_IS[34,4],
                     out_Peer_MDD_IS[33,4],out_Peer_MDD_IS[30,4])
parameters_Peer_MDD$MDD_IR <- c(out_Peer_MDD_IR[25,4],out_Peer_MDD_IR[27,4],out_Peer_MDD_IR[6,4],out_Peer_MDD_IR[16,4],
                     out_Peer_MDD_IR[26,4],out_Peer_MDD_IR[28,4],out_Peer_MDD_IR[29,4],
                     out_Peer_MDD_IR[31,4],out_Peer_MDD_IR[34,4],
                     out_Peer_MDD_IR[33,4],out_Peer_MDD_IR[30,4])
parameters_Peer_MDD$MDD_T <- c(out_Peer_MDD_T[25,4],out_Peer_MDD_T[27,4],out_Peer_MDD_T[6,4],out_Peer_MDD_T[16,4],
                     out_Peer_MDD_T[26,4],out_Peer_MDD_T[28,4],out_Peer_MDD_T[29,4],
                     out_Peer_MDD_T[31,4],out_Peer_MDD_T[34,4],
                     out_Peer_MDD_T[33,4],out_Peer_MDD_T[30,4])
parameters_Peer_MDD$MDD_D <- c(out_Peer_MDD[25,4],out_Peer_MDD[27,4],out_Peer_MDD[6,4],mean(as.numeric(out_Peer_MDD[16:20,4])),
                     out_Peer_MDD[26,4],out_Peer_MDD[28,4],out_Peer_MDD[29,4],
                     out_Peer_MDD[31,4],out_Peer_MDD[34,4],
                     out_Peer_MDD[33,4],out_Peer_MDD[30,4])
parameters_Peer_MDD <- as.data.frame(parameters_Peer_MDD)
parameters_Peer_MDD[,-1] <- apply(parameters_Peer_MDD[,-1], 2, as.character)
parameters_Peer_MDD[4,][is.na(parameters_Peer_MDD[4,])] <- "--"
parameters_Peer_MDD <- parameters_Peer_MDD %>%
  select("Model_Parameters",ends_with("_B"),ends_with("_IS"),ends_with("_IR"),ends_with("_T"),ends_with("_D"))

#Make the table
options(knitr.kable.NA="")
kable(parameters_Peer_MDD, digits=2,
                        align=c('l',rep('c', 10)),
                        col.names=c(" ", rep(c("Peer","MDD"), times=5)))
kable(fitstats_Peer_MDD, digits=2,
                        align=c('l',rep('c', 10)),
                        col.names=c(" ", rep(c("Peer","MDD"), times=5)))


#Agg_EXTL
# Make table of fit statistics
fitstats_Agg_EXTL <- as.data.frame(matrix(ncol=11,nrow=10))
colnames(fitstats_Agg_EXTL) <- c("Model_Parameters","Agg_B","EXTL_B","Agg_IS","EXTL_IS","Agg_IR","EXTL_IR","Agg_T","EXTL_T","Agg_D","EXTL_D")
fitstats_Agg_EXTL[,1] <- c(list_of_fit_stats,"∆χ2 to baseline")
fitstats_Agg_EXTL[,2:3] <- c(fitmeasures(fit_Agg_EXTL_B, fit.measures=list_of_fit_stats),"--")
fitstats_Agg_EXTL[,4:5] <- c(fitmeasures(fit_Agg_EXTL_IS, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IS)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IS)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IS)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IS)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IS)[2,5],2)))))
fitstats_Agg_EXTL[,6:7] <- c(fitmeasures(fit_Agg_EXTL_IR, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IR)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IR)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IR)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IR)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IR)[2,5],2)))))
fitstats_Agg_EXTL[,8:9] <- c(fitmeasures(fit_Agg_EXTL_T, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_T)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_T)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_T)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_T)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_T)[2,5],2)))))
fitstats_Agg_EXTL[,10:11] <- c(fitmeasures(fit_Agg_EXTL, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL)[2,5],2)))))
fitstats_Agg_EXTL[,2:11] <- apply(fitstats_Agg_EXTL[,2:11], 2, as.numeric) #FIX THIS
fitstats_Agg_EXTL[c(1:4,8:9),2:11] <- round(fitstats_Agg_EXTL[c(1:4,8:9),2:11], 0)
fitstats_Agg_EXTL[5:7,2:11] <- round(fitstats_Agg_EXTL[5:7,2:11], 3)
fitstats_Agg_EXTL <- as.data.frame(fitstats_Agg_EXTL)
fitstats_Agg_EXTL[,1] <- c("Parameters","Df","Log Likelihood","χ2","CFI","RMSEA","SRMR","AIC","BIC","∆χ2 to Baseline")

# Make table of parameters
# Select only the necessary parameters, removing the 'label', 'se', and 'z' columns
out_Agg_EXTL_B <- parameterEstimates(fit_Agg_EXTL_B)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Agg_EXTL_B) <- seq(length=nrow(out_Agg_EXTL_B))

out_Agg_EXTL_IS <- parameterEstimates(fit_Agg_EXTL_IS)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Agg_EXTL_IS) <- seq(length=nrow(out_Agg_EXTL_IS))

out_Agg_EXTL_IR <- parameterEstimates(fit_Agg_EXTL_IR)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Agg_EXTL_IR) <- seq(length=nrow(out_Agg_EXTL_IR))

out_Agg_EXTL_T <- parameterEstimates(fit_Agg_EXTL_T)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Agg_EXTL_T) <- seq(length=nrow(out_Agg_EXTL_T))

out_Agg_EXTL <- parameterEstimates(fit_Agg_EXTL)[c(129:148,155:158,165:168,169:174),] %>%
  select(-se,-z) %>%
    mutate(est = round(est,3))
rownames(out_Agg_EXTL) <- seq(length=nrow(out_Agg_EXTL))

# Create blank output table
parameters_Agg_EXTL <- NULL
parameters_Agg_EXTL$Model_Parameters <- c("Intercept mean","Slope mean","Self-feedback","Coupling",
                        "Intercept Variance","Slope Variance","Correlation ρ01",
                        "Correlation ρp0m0","Correlation ρp1m1",
                        "Correlation ρp0m1","Correlation ρp1m0")
# Fill the table with the appropriate values
parameters_Agg_EXTL$Agg_B <- c(out_Agg_EXTL_B[21,4],out_Agg_EXTL_B[23,4],out_Agg_EXTL_B[1,4],out_Agg_EXTL_B[11,4],
                     out_Agg_EXTL_B[22,4],out_Agg_EXTL_B[24,4],out_Agg_EXTL_B[32,4],
                     out_Agg_EXTL_B[31,4],out_Agg_EXTL_B[34,4],
                     out_Agg_EXTL_B[33,4],out_Agg_EXTL_B[30,4])
parameters_Agg_EXTL$Agg_IS <- c(out_Agg_EXTL_IS[21,4],out_Agg_EXTL_IS[23,4],out_Agg_EXTL_IS[1,4],out_Agg_EXTL_IS[11,4],
                     out_Agg_EXTL_IS[22,4],out_Agg_EXTL_IS[24,4],out_Agg_EXTL_IS[32,4],
                     out_Agg_EXTL_IS[31,4],out_Agg_EXTL_IS[34,4],
                     out_Agg_EXTL_IS[33,4],out_Agg_EXTL_IS[30,4])
parameters_Agg_EXTL$Agg_IR <- c(out_Agg_EXTL_IR[21,4],out_Agg_EXTL_IR[23,4],out_Agg_EXTL_IR[1,4],out_Agg_EXTL_IR[11,4],
                     out_Agg_EXTL_IR[22,4],out_Agg_EXTL_IR[24,4],out_Agg_EXTL_IR[32,4],
                     out_Agg_EXTL_IR[31,4],out_Agg_EXTL_IR[34,4],
                     out_Agg_EXTL_IR[33,4],out_Agg_EXTL_IR[30,4])
parameters_Agg_EXTL$Agg_T <- c(out_Agg_EXTL_T[21,4],out_Agg_EXTL_T[23,4],out_Agg_EXTL_T[1,4],out_Agg_EXTL_T[11,4],
                     out_Agg_EXTL_T[22,4],out_Agg_EXTL_T[24,4],out_Agg_EXTL_T[32,4],
                     out_Agg_EXTL_T[31,4],out_Agg_EXTL_T[34,4],
                     out_Agg_EXTL_T[33,4],out_Agg_EXTL_T[30,4])
parameters_Agg_EXTL$Agg_D <- c(out_Agg_EXTL[21,4],out_Agg_EXTL[23,4],out_Agg_EXTL[1,4],mean(as.numeric(out_Agg_EXTL[11:15,4])),
                     out_Agg_EXTL[22,4],out_Agg_EXTL[24,4],out_Agg_EXTL[32,4],
                     out_Agg_EXTL[31,4],out_Agg_EXTL[34,4],
                     out_Agg_EXTL[33,4],out_Agg_EXTL[30,4])

parameters_Agg_EXTL$EXTL_B <- c(out_Agg_EXTL_B[25,4],out_Agg_EXTL_B[27,4],out_Agg_EXTL_B[6,4],out_Agg_EXTL_B[16,4],
                     out_Agg_EXTL_B[26,4],out_Agg_EXTL_B[28,4],out_Agg_EXTL_B[29,4],
                     out_Agg_EXTL_B[31,4],out_Agg_EXTL_B[34,4],
                     out_Agg_EXTL_B[33,4],out_Agg_EXTL_B[30,4])
parameters_Agg_EXTL$EXTL_IS <- c(out_Agg_EXTL_IS[25,4],out_Agg_EXTL_IS[27,4],out_Agg_EXTL_IS[6,4],out_Agg_EXTL_IS[16,4],
                     out_Agg_EXTL_IS[26,4],out_Agg_EXTL_IS[28,4],out_Agg_EXTL_IS[29,4],
                     out_Agg_EXTL_IS[31,4],out_Agg_EXTL_IS[34,4],
                     out_Agg_EXTL_IS[33,4],out_Agg_EXTL_IS[30,4])
parameters_Agg_EXTL$EXTL_IR <- c(out_Agg_EXTL_IR[25,4],out_Agg_EXTL_IR[27,4],out_Agg_EXTL_IR[6,4],out_Agg_EXTL_IR[16,4],
                     out_Agg_EXTL_IR[26,4],out_Agg_EXTL_IR[28,4],out_Agg_EXTL_IR[29,4],
                     out_Agg_EXTL_IR[31,4],out_Agg_EXTL_IR[34,4],
                     out_Agg_EXTL_IR[33,4],out_Agg_EXTL_IR[30,4])
parameters_Agg_EXTL$EXTL_T <- c(out_Agg_EXTL_T[25,4],out_Agg_EXTL_T[27,4],out_Agg_EXTL_T[6,4],out_Agg_EXTL_T[16,4],
                     out_Agg_EXTL_T[26,4],out_Agg_EXTL_T[28,4],out_Agg_EXTL_T[29,4],
                     out_Agg_EXTL_T[31,4],out_Agg_EXTL_T[34,4],
                     out_Agg_EXTL_T[33,4],out_Agg_EXTL_T[30,4])
parameters_Agg_EXTL$EXTL_D <- c(out_Agg_EXTL[25,4],out_Agg_EXTL[27,4],out_Agg_EXTL[6,4],mean(as.numeric(out_Agg_EXTL[16:20,4])),
                     out_Agg_EXTL[26,4],out_Agg_EXTL[28,4],out_Agg_EXTL[29,4],
                     out_Agg_EXTL[31,4],out_Agg_EXTL[34,4],
                     out_Agg_EXTL[33,4],out_Agg_EXTL[30,4])
parameters_Agg_EXTL <- as.data.frame(parameters_Agg_EXTL)
parameters_Agg_EXTL[,-1] <- apply(parameters_Agg_EXTL[,-1], 2, as.character)
parameters_Agg_EXTL[4,][is.na(parameters_Agg_EXTL[4,])] <- "--"
parameters_Agg_EXTL <- parameters_Agg_EXTL %>%
  select("Model_Parameters",ends_with("_B"),ends_with("_IS"),ends_with("_IR"),ends_with("_T"),ends_with("_D"))

#Make the table
options(knitr.kable.NA="")
kable(parameters_Agg_EXTL, digits=2,
                        align=c('l',rep('c', 10)),
                        col.names=c(" ", rep(c("Agg","EXTL"), times=5)))
kable(fitstats_Agg_EXTL, digits=2,
                        align=c('l',rep('c', 10)),
                        col.names=c(" ", rep(c("Agg","EXTL"), times=5)))


#Sw_INTL
# Make table of fit statistics
fitstats_Sw_INTL <- as.data.frame(matrix(ncol=11,nrow=10))
colnames(fitstats_Sw_INTL) <- c("Model_Parameters","Sw_B","INTL_B","Sw_IS","INTL_IS","Sw_IR","INTL_IR","Sw_T","INTL_T","Sw_D","INTL_D")
fitstats_Sw_INTL[,1] <- c(list_of_fit_stats,"∆χ2 to baseline")
fitstats_Sw_INTL[,2:3] <- c(fitmeasures(fit_Sw_INTL_B, fit.measures=list_of_fit_stats),"--")
fitstats_Sw_INTL[,4:5] <- c(fitmeasures(fit_Sw_INTL_IS, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IS)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IS)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IS)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IS)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IS)[2,5],2)))))
fitstats_Sw_INTL[,6:7] <- c(fitmeasures(fit_Sw_INTL_IR, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IR)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IR)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IR)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IR)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IR)[2,5],2)))))
fitstats_Sw_INTL[,8:9] <- c(fitmeasures(fit_Sw_INTL_T, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_T)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_T)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_T)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_T)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_T)[2,5],2)))))
fitstats_Sw_INTL[,10:11] <- c(fitmeasures(fit_Sw_INTL, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL)[2,5],2)))))
fitstats_Sw_INTL[,2:11] <- apply(fitstats_Sw_INTL[,2:11], 2, as.numeric) #FIX THIS
fitstats_Sw_INTL[c(1:4,8:9),2:11] <- round(fitstats_Sw_INTL[c(1:4,8:9),2:11], 0)
fitstats_Sw_INTL[5:7,2:11] <- round(fitstats_Sw_INTL[5:7,2:11], 3)
fitstats_Sw_INTL <- as.data.frame(fitstats_Sw_INTL)
fitstats_Sw_INTL[,1] <- c("Parameters","Df","Log Likelihood","χ2","CFI","RMSEA","SRMR","AIC","BIC","∆χ2 to Baseline")

# Make table of parameters
# Select only the necessary parameters, removing the 'label', 'se', and 'z' columns
out_Sw_INTL_B <- parameterEstimates(fit_Sw_INTL_B)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Sw_INTL_B) <- seq(length=nrow(out_Sw_INTL_B))

out_Sw_INTL_IS <- parameterEstimates(fit_Sw_INTL_IS)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Sw_INTL_IS) <- seq(length=nrow(out_Sw_INTL_IS))

out_Sw_INTL_IR <- parameterEstimates(fit_Sw_INTL_IR)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Sw_INTL_IR) <- seq(length=nrow(out_Sw_INTL_IR))

out_Sw_INTL_T <- parameterEstimates(fit_Sw_INTL_T)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Sw_INTL_T) <- seq(length=nrow(out_Sw_INTL_T))

out_Sw_INTL <- parameterEstimates(fit_Sw_INTL)[c(129:148,155:158,165:168,169:174),] %>%
  select(-se,-z) %>%
    mutate(est = round(est,3))
rownames(out_Sw_INTL) <- seq(length=nrow(out_Sw_INTL))

# Create blank output table
parameters_Sw_INTL <- NULL
parameters_Sw_INTL$Model_Parameters <- c("Intercept mean","Slope mean","Self-feedback","Coupling",
                        "Intercept Variance","Slope Variance","Correlation ρ01",
                        "Correlation ρp0m0","Correlation ρp1m1",
                        "Correlation ρp0m1","Correlation ρp1m0")
# Fill the table with the appropriate values
parameters_Sw_INTL$Sw_B <- c(out_Sw_INTL_B[21,4],out_Sw_INTL_B[23,4],out_Sw_INTL_B[1,4],out_Sw_INTL_B[11,4],
                     out_Sw_INTL_B[22,4],out_Sw_INTL_B[24,4],out_Sw_INTL_B[32,4],
                     out_Sw_INTL_B[31,4],out_Sw_INTL_B[34,4],
                     out_Sw_INTL_B[33,4],out_Sw_INTL_B[30,4])
parameters_Sw_INTL$Sw_IS <- c(out_Sw_INTL_IS[21,4],out_Sw_INTL_IS[23,4],out_Sw_INTL_IS[1,4],out_Sw_INTL_IS[11,4],
                     out_Sw_INTL_IS[22,4],out_Sw_INTL_IS[24,4],out_Sw_INTL_IS[32,4],
                     out_Sw_INTL_IS[31,4],out_Sw_INTL_IS[34,4],
                     out_Sw_INTL_IS[33,4],out_Sw_INTL_IS[30,4])
parameters_Sw_INTL$Sw_IR <- c(out_Sw_INTL_IR[21,4],out_Sw_INTL_IR[23,4],out_Sw_INTL_IR[1,4],out_Sw_INTL_IR[11,4],
                     out_Sw_INTL_IR[22,4],out_Sw_INTL_IR[24,4],out_Sw_INTL_IR[32,4],
                     out_Sw_INTL_IR[31,4],out_Sw_INTL_IR[34,4],
                     out_Sw_INTL_IR[33,4],out_Sw_INTL_IR[30,4])
parameters_Sw_INTL$Sw_T <- c(out_Sw_INTL_T[21,4],out_Sw_INTL_T[23,4],out_Sw_INTL_T[1,4],out_Sw_INTL_T[11,4],
                     out_Sw_INTL_T[22,4],out_Sw_INTL_T[24,4],out_Sw_INTL_T[32,4],
                     out_Sw_INTL_T[31,4],out_Sw_INTL_T[34,4],
                     out_Sw_INTL_T[33,4],out_Sw_INTL_T[30,4])
parameters_Sw_INTL$Sw_D <- c(out_Sw_INTL[21,4],out_Sw_INTL[23,4],out_Sw_INTL[1,4],mean(as.numeric(out_Sw_INTL[11:15,4])),
                     out_Sw_INTL[22,4],out_Sw_INTL[24,4],out_Sw_INTL[32,4],
                     out_Sw_INTL[31,4],out_Sw_INTL[34,4],
                     out_Sw_INTL[33,4],out_Sw_INTL[30,4])

parameters_Sw_INTL$INTL_B <- c(out_Sw_INTL_B[25,4],out_Sw_INTL_B[27,4],out_Sw_INTL_B[6,4],out_Sw_INTL_B[16,4],
                     out_Sw_INTL_B[26,4],out_Sw_INTL_B[28,4],out_Sw_INTL_B[29,4],
                     out_Sw_INTL_B[31,4],out_Sw_INTL_B[34,4],
                     out_Sw_INTL_B[33,4],out_Sw_INTL_B[30,4])
parameters_Sw_INTL$INTL_IS <- c(out_Sw_INTL_IS[25,4],out_Sw_INTL_IS[27,4],out_Sw_INTL_IS[6,4],out_Sw_INTL_IS[16,4],
                     out_Sw_INTL_IS[26,4],out_Sw_INTL_IS[28,4],out_Sw_INTL_IS[29,4],
                     out_Sw_INTL_IS[31,4],out_Sw_INTL_IS[34,4],
                     out_Sw_INTL_IS[33,4],out_Sw_INTL_IS[30,4])
parameters_Sw_INTL$INTL_IR <- c(out_Sw_INTL_IR[25,4],out_Sw_INTL_IR[27,4],out_Sw_INTL_IR[6,4],out_Sw_INTL_IR[16,4],
                     out_Sw_INTL_IR[26,4],out_Sw_INTL_IR[28,4],out_Sw_INTL_IR[29,4],
                     out_Sw_INTL_IR[31,4],out_Sw_INTL_IR[34,4],
                     out_Sw_INTL_IR[33,4],out_Sw_INTL_IR[30,4])
parameters_Sw_INTL$INTL_T <- c(out_Sw_INTL_T[25,4],out_Sw_INTL_T[27,4],out_Sw_INTL_T[6,4],out_Sw_INTL_T[16,4],
                     out_Sw_INTL_T[26,4],out_Sw_INTL_T[28,4],out_Sw_INTL_T[29,4],
                     out_Sw_INTL_T[31,4],out_Sw_INTL_T[34,4],
                     out_Sw_INTL_T[33,4],out_Sw_INTL_T[30,4])
parameters_Sw_INTL$INTL_D <- c(out_Sw_INTL[25,4],out_Sw_INTL[27,4],out_Sw_INTL[6,4],mean(as.numeric(out_Sw_INTL[16:20,4])),
                     out_Sw_INTL[26,4],out_Sw_INTL[28,4],out_Sw_INTL[29,4],
                     out_Sw_INTL[31,4],out_Sw_INTL[34,4],
                     out_Sw_INTL[33,4],out_Sw_INTL[30,4])
parameters_Sw_INTL <- as.data.frame(parameters_Sw_INTL)
parameters_Sw_INTL[,-1] <- apply(parameters_Sw_INTL[,-1], 2, as.character)
parameters_Sw_INTL[4,][is.na(parameters_Sw_INTL[4,])] <- "--"
parameters_Sw_INTL <- parameters_Sw_INTL %>%
  select("Model_Parameters",ends_with("_B"),ends_with("_IS"),ends_with("_IR"),ends_with("_T"),ends_with("_D"))

#Make the table
options(knitr.kable.NA="")
kable(parameters_Sw_INTL, digits=2,
                        align=c('l',rep('c', 10)),
                        col.names=c(" ", rep(c("Sw","INTL"), times=5)))
kable(fitstats_Sw_INTL, digits=2,
                        align=c('l',rep('c', 10)),
                        col.names=c(" ", rep(c("Sw","INTL"), times=5)))



#Pro_INTL
# Make table of fit statistics
fitstats_Pro_INTL <- as.data.frame(matrix(ncol=11,nrow=10))
colnames(fitstats_Pro_INTL) <- c("Model_Parameters","Pro_B","INTL_B","Pro_IS","INTL_IS","Pro_IR","INTL_IR","Pro_T","INTL_T","Pro_D","INTL_D")
fitstats_Pro_INTL[,1] <- c(list_of_fit_stats,"∆χ2 to baseline")
fitstats_Pro_INTL[,2:3] <- c(fitmeasures(fit_Pro_INTL_B, fit.measures=list_of_fit_stats),"--")
fitstats_Pro_INTL[,4:5] <- c(fitmeasures(fit_Pro_INTL_IS, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IS)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IS)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IS)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IS)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IS)[2,5],2)))))
fitstats_Pro_INTL[,6:7] <- c(fitmeasures(fit_Pro_INTL_IR, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IR)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IR)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IR)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IR)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IR)[2,5],2)))))
fitstats_Pro_INTL[,8:9] <- c(fitmeasures(fit_Pro_INTL_T, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_T)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_T)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_T)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_T)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_T)[2,5],2)))))
fitstats_Pro_INTL[,10:11] <- c(fitmeasures(fit_Pro_INTL, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL)[2,5],2)))))
fitstats_Pro_INTL[,2:11] <- apply(fitstats_Pro_INTL[,2:11], 2, as.numeric) #FIX THIS
fitstats_Pro_INTL[c(1:4,8:9),2:11] <- round(fitstats_Pro_INTL[c(1:4,8:9),2:11], 0)
fitstats_Pro_INTL[5:7,2:11] <- round(fitstats_Pro_INTL[5:7,2:11], 3)
fitstats_Pro_INTL <- as.data.frame(fitstats_Pro_INTL)
fitstats_Pro_INTL[,1] <- c("Parameters","Df","Log Likelihood","χ2","CFI","RMSEA","SRMR","AIC","BIC","∆χ2 to Baseline")

# Make table of parameters
# Select only the necessary parameters, removing the 'label', 'se', and 'z' columns
out_Pro_INTL_B <- parameterEstimates(fit_Pro_INTL_B)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Pro_INTL_B) <- seq(length=nrow(out_Pro_INTL_B))

out_Pro_INTL_IS <- parameterEstimates(fit_Pro_INTL_IS)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Pro_INTL_IS) <- seq(length=nrow(out_Pro_INTL_IS))

out_Pro_INTL_IR <- parameterEstimates(fit_Pro_INTL_IR)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Pro_INTL_IR) <- seq(length=nrow(out_Pro_INTL_IR))

out_Pro_INTL_T <- parameterEstimates(fit_Pro_INTL_T)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Pro_INTL_T) <- seq(length=nrow(out_Pro_INTL_T))

out_Pro_INTL <- parameterEstimates(fit_Pro_INTL)[c(129:148,155:158,165:168,169:174),] %>%
  select(-se,-z) %>%
    mutate(est = round(est,3))
rownames(out_Pro_INTL) <- seq(length=nrow(out_Pro_INTL))

# Create blank output table
parameters_Pro_INTL <- NULL
parameters_Pro_INTL$Model_Parameters <- c("Intercept mean","Slope mean","Self-feedback","Coupling",
                        "Intercept Variance","Slope Variance","Correlation ρ01",
                        "Correlation ρp0m0","Correlation ρp1m1",
                        "Correlation ρp0m1","Correlation ρp1m0")
# Fill the table with the appropriate values
parameters_Pro_INTL$Pro_B <- c(out_Pro_INTL_B[21,4],out_Pro_INTL_B[23,4],out_Pro_INTL_B[1,4],out_Pro_INTL_B[11,4],
                     out_Pro_INTL_B[22,4],out_Pro_INTL_B[24,4],out_Pro_INTL_B[32,4],
                     out_Pro_INTL_B[31,4],out_Pro_INTL_B[34,4],
                     out_Pro_INTL_B[33,4],out_Pro_INTL_B[30,4])
parameters_Pro_INTL$Pro_IS <- c(out_Pro_INTL_IS[21,4],out_Pro_INTL_IS[23,4],out_Pro_INTL_IS[1,4],out_Pro_INTL_IS[11,4],
                     out_Pro_INTL_IS[22,4],out_Pro_INTL_IS[24,4],out_Pro_INTL_IS[32,4],
                     out_Pro_INTL_IS[31,4],out_Pro_INTL_IS[34,4],
                     out_Pro_INTL_IS[33,4],out_Pro_INTL_IS[30,4])
parameters_Pro_INTL$Pro_IR <- c(out_Pro_INTL_IR[21,4],out_Pro_INTL_IR[23,4],out_Pro_INTL_IR[1,4],out_Pro_INTL_IR[11,4],
                     out_Pro_INTL_IR[22,4],out_Pro_INTL_IR[24,4],out_Pro_INTL_IR[32,4],
                     out_Pro_INTL_IR[31,4],out_Pro_INTL_IR[34,4],
                     out_Pro_INTL_IR[33,4],out_Pro_INTL_IR[30,4])
parameters_Pro_INTL$Pro_T <- c(out_Pro_INTL_T[21,4],out_Pro_INTL_T[23,4],out_Pro_INTL_T[1,4],out_Pro_INTL_T[11,4],
                     out_Pro_INTL_T[22,4],out_Pro_INTL_T[24,4],out_Pro_INTL_T[32,4],
                     out_Pro_INTL_T[31,4],out_Pro_INTL_T[34,4],
                     out_Pro_INTL_T[33,4],out_Pro_INTL_T[30,4])
parameters_Pro_INTL$Pro_D <- c(out_Pro_INTL[21,4],out_Pro_INTL[23,4],out_Pro_INTL[1,4],mean(as.numeric(out_Pro_INTL[11:15,4])),
                     out_Pro_INTL[22,4],out_Pro_INTL[24,4],out_Pro_INTL[32,4],
                     out_Pro_INTL[31,4],out_Pro_INTL[34,4],
                     out_Pro_INTL[33,4],out_Pro_INTL[30,4])

parameters_Pro_INTL$INTL_B <- c(out_Pro_INTL_B[25,4],out_Pro_INTL_B[27,4],out_Pro_INTL_B[6,4],out_Pro_INTL_B[16,4],
                     out_Pro_INTL_B[26,4],out_Pro_INTL_B[28,4],out_Pro_INTL_B[29,4],
                     out_Pro_INTL_B[31,4],out_Pro_INTL_B[34,4],
                     out_Pro_INTL_B[33,4],out_Pro_INTL_B[30,4])
parameters_Pro_INTL$INTL_IS <- c(out_Pro_INTL_IS[25,4],out_Pro_INTL_IS[27,4],out_Pro_INTL_IS[6,4],out_Pro_INTL_IS[16,4],
                     out_Pro_INTL_IS[26,4],out_Pro_INTL_IS[28,4],out_Pro_INTL_IS[29,4],
                     out_Pro_INTL_IS[31,4],out_Pro_INTL_IS[34,4],
                     out_Pro_INTL_IS[33,4],out_Pro_INTL_IS[30,4])
parameters_Pro_INTL$INTL_IR <- c(out_Pro_INTL_IR[25,4],out_Pro_INTL_IR[27,4],out_Pro_INTL_IR[6,4],out_Pro_INTL_IR[16,4],
                     out_Pro_INTL_IR[26,4],out_Pro_INTL_IR[28,4],out_Pro_INTL_IR[29,4],
                     out_Pro_INTL_IR[31,4],out_Pro_INTL_IR[34,4],
                     out_Pro_INTL_IR[33,4],out_Pro_INTL_IR[30,4])
parameters_Pro_INTL$INTL_T <- c(out_Pro_INTL_T[25,4],out_Pro_INTL_T[27,4],out_Pro_INTL_T[6,4],out_Pro_INTL_T[16,4],
                     out_Pro_INTL_T[26,4],out_Pro_INTL_T[28,4],out_Pro_INTL_T[29,4],
                     out_Pro_INTL_T[31,4],out_Pro_INTL_T[34,4],
                     out_Pro_INTL_T[33,4],out_Pro_INTL_T[30,4])
parameters_Pro_INTL$INTL_D <- c(out_Pro_INTL[25,4],out_Pro_INTL[27,4],out_Pro_INTL[6,4],mean(as.numeric(out_Pro_INTL[16:20,4])),
                     out_Pro_INTL[26,4],out_Pro_INTL[28,4],out_Pro_INTL[29,4],
                     out_Pro_INTL[31,4],out_Pro_INTL[34,4],
                     out_Pro_INTL[33,4],out_Pro_INTL[30,4])
parameters_Pro_INTL <- as.data.frame(parameters_Pro_INTL)
parameters_Pro_INTL[,-1] <- apply(parameters_Pro_INTL[,-1], 2, as.character)
parameters_Pro_INTL[4,][is.na(parameters_Pro_INTL[4,])] <- "--"
parameters_Pro_INTL <- parameters_Pro_INTL %>%
  select("Model_Parameters",ends_with("_B"),ends_with("_IS"),ends_with("_IR"),ends_with("_T"),ends_with("_D"))

#Make the table
options(knitr.kable.NA="")
kable(parameters_Pro_INTL, digits=2,
                        align=c('l',rep('c', 10)),
                        col.names=c(" ", rep(c("Pro","INTL"), times=5)))
kable(fitstats_Pro_INTL, digits=2,
                        align=c('l',rep('c', 10)),
                        col.names=c(" ", rep(c("Pro","INTL"), times=5)))


#Pro_EXTL
# Make table of fit statistics
fitstats_Pro_EXTL <- as.data.frame(matrix(ncol=11,nrow=10))
colnames(fitstats_Pro_EXTL) <- c("Model_Parameters","Pro_B","EXTL_B","Pro_IS","EXTL_IS","Pro_IR","EXTL_IR","Pro_T","EXTL_T","Pro_D","EXTL_D")
fitstats_Pro_EXTL[,1] <- c(list_of_fit_stats,"∆χ2 to baseline")
fitstats_Pro_EXTL[,2:3] <- c(fitmeasures(fit_Pro_EXTL_B, fit.measures=list_of_fit_stats),"--")
fitstats_Pro_EXTL[,4:5] <- c(fitmeasures(fit_Pro_EXTL_IS, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IS)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IS)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IS)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IS)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IS)[2,5],2)))))
fitstats_Pro_EXTL[,6:7] <- c(fitmeasures(fit_Pro_EXTL_IR, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IR)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IR)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IR)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IR)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IR)[2,5],2)))))
fitstats_Pro_EXTL[,8:9] <- c(fitmeasures(fit_Pro_EXTL_T, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_T)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_T)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_T)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_T)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_T)[2,5],2)))))
fitstats_Pro_EXTL[,10:11] <- c(fitmeasures(fit_Pro_EXTL, fit.measures=list_of_fit_stats),
                             ifelse(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL)[2,7]<.01,
                                    paste0(round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL)[2,5],2),"**"),
                                    ifelse(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL)[2,7]<.05,
                                    paste0(round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL)[2,5],2),"*"),
                                    (round(lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL)[2,5],2)))))
fitstats_Pro_EXTL[,2:11] <- apply(fitstats_Pro_EXTL[,2:11], 2, as.numeric) #FIX THIS
fitstats_Pro_EXTL[c(1:4,8:9),2:11] <- round(fitstats_Pro_EXTL[c(1:4,8:9),2:11], 0)
fitstats_Pro_EXTL[5:7,2:11] <- round(fitstats_Pro_EXTL[5:7,2:11], 3)
fitstats_Pro_EXTL <- as.data.frame(fitstats_Pro_EXTL)
fitstats_Pro_EXTL[,1] <- c("Parameters","Df","Log Likelihood","χ2","CFI","RMSEA","SRMR","AIC","BIC","∆χ2 to Baseline")

# Make table of parameters
# Select only the necessary parameters, removing the 'label', 'se', and 'z' columns
out_Pro_EXTL_B <- parameterEstimates(fit_Pro_EXTL_B)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Pro_EXTL_B) <- seq(length=nrow(out_Pro_EXTL_B))

out_Pro_EXTL_IS <- parameterEstimates(fit_Pro_EXTL_IS)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Pro_EXTL_IS) <- seq(length=nrow(out_Pro_EXTL_IS))

out_Pro_EXTL_IR <- parameterEstimates(fit_Pro_EXTL_IR)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Pro_EXTL_IR) <- seq(length=nrow(out_Pro_EXTL_IR))

out_Pro_EXTL_T <- parameterEstimates(fit_Pro_EXTL_T)[c(129:148,155:158,165:168,169:174),] %>%
  select(-label,-se,-z) %>%
    mutate(est = if_else(pvalue<.01, paste0(round(est,3),"**"), if_else(pvalue<.05, paste0(round(est,3),"*"), paste0(round(est,3)))))
rownames(out_Pro_EXTL_T) <- seq(length=nrow(out_Pro_EXTL_T))

out_Pro_EXTL <- parameterEstimates(fit_Pro_EXTL)[c(129:148,155:158,165:168,169:174),] %>%
  select(-se,-z) %>%
    mutate(est = round(est,3))
rownames(out_Pro_EXTL) <- seq(length=nrow(out_Pro_EXTL))

# Create blank output table
parameters_Pro_EXTL <- NULL
parameters_Pro_EXTL$Model_Parameters <- c("Intercept mean","Slope mean","Self-feedback","Coupling",
                        "Intercept Variance","Slope Variance","Correlation ρ01",
                        "Correlation ρp0m0","Correlation ρp1m1",
                        "Correlation ρp0m1","Correlation ρp1m0")
# Fill the table with the appropriate values
parameters_Pro_EXTL$Pro_B <- c(out_Pro_EXTL_B[21,4],out_Pro_EXTL_B[23,4],out_Pro_EXTL_B[1,4],out_Pro_EXTL_B[11,4],
                     out_Pro_EXTL_B[22,4],out_Pro_EXTL_B[24,4],out_Pro_EXTL_B[32,4],
                     out_Pro_EXTL_B[31,4],out_Pro_EXTL_B[34,4],
                     out_Pro_EXTL_B[33,4],out_Pro_EXTL_B[30,4])
parameters_Pro_EXTL$Pro_IS <- c(out_Pro_EXTL_IS[21,4],out_Pro_EXTL_IS[23,4],out_Pro_EXTL_IS[1,4],out_Pro_EXTL_IS[11,4],
                     out_Pro_EXTL_IS[22,4],out_Pro_EXTL_IS[24,4],out_Pro_EXTL_IS[32,4],
                     out_Pro_EXTL_IS[31,4],out_Pro_EXTL_IS[34,4],
                     out_Pro_EXTL_IS[33,4],out_Pro_EXTL_IS[30,4])
parameters_Pro_EXTL$Pro_IR <- c(out_Pro_EXTL_IR[21,4],out_Pro_EXTL_IR[23,4],out_Pro_EXTL_IR[1,4],out_Pro_EXTL_IR[11,4],
                     out_Pro_EXTL_IR[22,4],out_Pro_EXTL_IR[24,4],out_Pro_EXTL_IR[32,4],
                     out_Pro_EXTL_IR[31,4],out_Pro_EXTL_IR[34,4],
                     out_Pro_EXTL_IR[33,4],out_Pro_EXTL_IR[30,4])
parameters_Pro_EXTL$Pro_T <- c(out_Pro_EXTL_T[21,4],out_Pro_EXTL_T[23,4],out_Pro_EXTL_T[1,4],out_Pro_EXTL_T[11,4],
                     out_Pro_EXTL_T[22,4],out_Pro_EXTL_T[24,4],out_Pro_EXTL_T[32,4],
                     out_Pro_EXTL_T[31,4],out_Pro_EXTL_T[34,4],
                     out_Pro_EXTL_T[33,4],out_Pro_EXTL_T[30,4])
parameters_Pro_EXTL$Pro_D <- c(out_Pro_EXTL[21,4],out_Pro_EXTL[23,4],out_Pro_EXTL[1,4],mean(as.numeric(out_Pro_EXTL[11:15,4])),
                     out_Pro_EXTL[22,4],out_Pro_EXTL[24,4],out_Pro_EXTL[32,4],
                     out_Pro_EXTL[31,4],out_Pro_EXTL[34,4],
                     out_Pro_EXTL[33,4],out_Pro_EXTL[30,4])

parameters_Pro_EXTL$EXTL_B <- c(out_Pro_EXTL_B[25,4],out_Pro_EXTL_B[27,4],out_Pro_EXTL_B[6,4],out_Pro_EXTL_B[16,4],
                     out_Pro_EXTL_B[26,4],out_Pro_EXTL_B[28,4],out_Pro_EXTL_B[29,4],
                     out_Pro_EXTL_B[31,4],out_Pro_EXTL_B[34,4],
                     out_Pro_EXTL_B[33,4],out_Pro_EXTL_B[30,4])
parameters_Pro_EXTL$EXTL_IS <- c(out_Pro_EXTL_IS[25,4],out_Pro_EXTL_IS[27,4],out_Pro_EXTL_IS[6,4],out_Pro_EXTL_IS[16,4],
                     out_Pro_EXTL_IS[26,4],out_Pro_EXTL_IS[28,4],out_Pro_EXTL_IS[29,4],
                     out_Pro_EXTL_IS[31,4],out_Pro_EXTL_IS[34,4],
                     out_Pro_EXTL_IS[33,4],out_Pro_EXTL_IS[30,4])
parameters_Pro_EXTL$EXTL_IR <- c(out_Pro_EXTL_IR[25,4],out_Pro_EXTL_IR[27,4],out_Pro_EXTL_IR[6,4],out_Pro_EXTL_IR[16,4],
                     out_Pro_EXTL_IR[26,4],out_Pro_EXTL_IR[28,4],out_Pro_EXTL_IR[29,4],
                     out_Pro_EXTL_IR[31,4],out_Pro_EXTL_IR[34,4],
                     out_Pro_EXTL_IR[33,4],out_Pro_EXTL_IR[30,4])
parameters_Pro_EXTL$EXTL_T <- c(out_Pro_EXTL_T[25,4],out_Pro_EXTL_T[27,4],out_Pro_EXTL_T[6,4],out_Pro_EXTL_T[16,4],
                     out_Pro_EXTL_T[26,4],out_Pro_EXTL_T[28,4],out_Pro_EXTL_T[29,4],
                     out_Pro_EXTL_T[31,4],out_Pro_EXTL_T[34,4],
                     out_Pro_EXTL_T[33,4],out_Pro_EXTL_T[30,4])
parameters_Pro_EXTL$EXTL_D <- c(out_Pro_EXTL[25,4],out_Pro_EXTL[27,4],out_Pro_EXTL[6,4],mean(as.numeric(out_Pro_EXTL[16:20,4])),
                     out_Pro_EXTL[26,4],out_Pro_EXTL[28,4],out_Pro_EXTL[29,4],
                     out_Pro_EXTL[31,4],out_Pro_EXTL[34,4],
                     out_Pro_EXTL[33,4],out_Pro_EXTL[30,4])
parameters_Pro_EXTL <- as.data.frame(parameters_Pro_EXTL)
parameters_Pro_EXTL[,-1] <- apply(parameters_Pro_EXTL[,-1], 2, as.character)
parameters_Pro_EXTL[4,][is.na(parameters_Pro_EXTL[4,])] <- "--"
parameters_Pro_EXTL <- parameters_Pro_EXTL %>%
  select("Model_Parameters",ends_with("_B"),ends_with("_IS"),ends_with("_IR"),ends_with("_T"),ends_with("_D"))

#Make the table
options(knitr.kable.NA="")
kable(parameters_Pro_EXTL, digits=2,
                        align=c('l',rep('c', 10)),
                        col.names=c(" ", rep(c("Pro","EXTL"), times=5)))
kable(fitstats_Pro_EXTL, digits=2,
                        align=c('l',rep('c', 10)),
                        col.names=c(" ", rep(c("Pro","EXTL"), times=5)))
```


## Chi-square test table
```{r Chi-square test table, echo=TRUE, results = 'asis'}

#Combine the fit statistics table with the model parameters table
#table_Peer_MDD <- bind_rows(parameters_Peer_MDD,fitstats_Peer_MDD)

Chi_test_table <- as.data.frame(matrix(ncol=10, nrow=12))
colnames(Chi_test_table) <- c("Model",rep(c("∆χ2 to Baseline","∆Df","p value"),3))


Chi_test_table[2,] <- c("Interpersonal Scar", lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IS)[2,5:7],
                        lavTestLRT(fit_Peer_INTL_B,fit_Peer_INTL_IS)[2,5:7],
                        lavTestLRT(fit_Peer_EXTL_B,fit_Peer_EXTL_IS)[2,5:7])
Chi_test_table[3,] <- c("Interpersonal Risk", lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_IR)[2,5:7],
                        lavTestLRT(fit_Peer_INTL_B,fit_Peer_INTL_IR)[2,5:7],
                        lavTestLRT(fit_Peer_EXTL_B,fit_Peer_EXTL_IR)[2,5:7])
Chi_test_table[4,] <- c("Transactional", lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD_T)[2,5:7],
                        lavTestLRT(fit_Peer_INTL_B,fit_Peer_INTL_T)[2,5:7],
                        lavTestLRT(fit_Peer_EXTL_B,fit_Peer_EXTL_T)[2,5:7])
Chi_test_table[5,] <- c("Developmental", lavTestLRT(fit_Peer_MDD_B,fit_Peer_MDD)[2,5:7],
                        lavTestLRT(fit_Peer_INTL_B,fit_Peer_INTL)[2,5:7],
                        lavTestLRT(fit_Peer_EXTL_B,fit_Peer_EXTL)[2,5:7])

Chi_test_table[7,] <- c("Interpersonal Scar", lavTestLRT(fit_Agg_MDD_B,fit_Agg_MDD_IS)[2,5:7],
                        lavTestLRT(fit_Agg_INTL_B,fit_Agg_INTL_IS)[2,5:7],
                        lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IS)[2,5:7])
Chi_test_table[8,] <- c("Interpersonal Risk", lavTestLRT(fit_Agg_MDD_B,fit_Agg_MDD_IR)[2,5:7],
                        lavTestLRT(fit_Agg_INTL_B,fit_Agg_INTL_IR)[2,5:7],
                        lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_IR)[2,5:7])
Chi_test_table[9,] <- c("Transactional", lavTestLRT(fit_Agg_MDD_B,fit_Agg_MDD_T)[2,5:7],
                        lavTestLRT(fit_Agg_INTL_B,fit_Agg_INTL_T)[2,5:7],
                        lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL_T)[2,5:7])
Chi_test_table[10,] <- c("Developmental",  lavTestLRT(fit_Agg_MDD_B,fit_Agg_MDD)[2,5:7],
                         lavTestLRT(fit_Agg_INTL_B,fit_Agg_INTL)[2,5:7],
                         lavTestLRT(fit_Agg_EXTL_B,fit_Agg_EXTL)[2,5:7])

Chi_test_table[12,] <- c("Interpersonal Scar", lavTestLRT(fit_Sw_MDD_B,fit_Sw_MDD_IS)[2,5:7],
                        lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IS)[2,5:7],
                        lavTestLRT(fit_Sw_EXTL_B,fit_Sw_EXTL_IS)[2,5:7])
Chi_test_table[13,] <- c("Interpersonal Risk", lavTestLRT(fit_Sw_MDD_B,fit_Sw_MDD_IR)[2,5:7],
                        lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_IR)[2,5:7],
                        lavTestLRT(fit_Sw_EXTL_B,fit_Sw_EXTL_IR)[2,5:7])
Chi_test_table[14,] <- c("Transactional", lavTestLRT(fit_Sw_MDD_B,fit_Sw_MDD_T)[2,5:7],
                        lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL_T)[2,5:7],
                        lavTestLRT(fit_Sw_EXTL_B,fit_Sw_EXTL_T)[2,5:7])
Chi_test_table[15,] <- c("Developmental",  lavTestLRT(fit_Sw_MDD_B,fit_Sw_MDD)[2,5:7],
                        lavTestLRT(fit_Sw_INTL_B,fit_Sw_INTL)[2,5:7],
                        lavTestLRT(fit_Sw_EXTL_B,fit_Sw_EXTL)[2,5:7])

Chi_test_table[17,] <- c("Interpersonal Scar", lavTestLRT(fit_Pro_MDD_B,fit_Pro_MDD_IS)[2,5:7],
                        lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IS)[2,5:7],
                        lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IS)[2,5:7])
Chi_test_table[18,] <- c("Interpersonal Risk", lavTestLRT(fit_Pro_MDD_B,fit_Pro_MDD_IR)[2,5:7],
                        lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_IR)[2,5:7],
                        lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_IR)[2,5:7])
Chi_test_table[19,] <- c("Transactional", lavTestLRT(fit_Pro_MDD_B,fit_Pro_MDD_T)[2,5:7],
                        lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL_T)[2,5:7],
                        lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL_T)[2,5:7])
Chi_test_table[20,] <- c("Developmental", rep(NA,3),
                        lavTestLRT(fit_Pro_INTL_B,fit_Pro_INTL)[2,5:7],
                        lavTestLRT(fit_Pro_EXTL_B,fit_Pro_EXTL)[2,5:7])
#lavTestLRT(fit_Pro_MDD_B,fit_Pro_MDD)[2,5:7],
Chi_test_table[,2:10] <- round(Chi_test_table[,2:10], 2)

Chi_test_table[1,] <- c("Peer Victimization/Rejection",rep("",9))
Chi_test_table[6,] <- c("Aggression",rep("",9))
Chi_test_table[11,] <- c("Social Withdrawal",rep("",9))
Chi_test_table[16,] <- c("Prosocial",rep("",9))

options(knitr.kable.NA="--")
kable(Chi_test_table, digits=2,
                        align=c('l',rep('c', 9)),
                        col.names=c("Model", rep(c("∆χ2 to Baseline","Df","p value"), times=3)),
      caption="Table 2.Chi-square test of theoretical models compared to baseline models")


#         kable_styling(latex_options = "striped", full_width = F) %>%
#         add_header_above(c("Model Parameters"=1, "Baseline"=2, "Interpersonal Scar"=2, "Interpersonal Risk"=2, 
#                            "Transactional"=2, "Developmental"=2)) %>%
#         group_rows("Fixed Effects", 1, 4) %>%
#         group_rows("Random Effects", 5, 11) %>%
#         add_footnote(c("Peer: Peer victimization/rejection scores on the HBQ", "MDD: Proportion of depression symptoms on PAPA/CAPA"), 
#                      notation = "alphabet")
```


## Check basline models for significant intercept and slope correlations
```{r Check baseline models for significant intercept and slope correlations}
parameterEstimates(fit_Peer_INTL_B)[c(170:174),c(1:3,5,8)]
parameterEstimates(fit_Peer_EXTL_B)[c(170:174),c(1:3,5,8)]

parameterEstimates(fit_Agg_MDD_B)[c(170:174),c(1:3,5,8)]
parameterEstimates(fit_Agg_INTL_B)[c(170:174),c(1:3,5,8)]

parameterEstimates(fit_Sw_MDD_B)[c(170:174),c(1:3,5,8)]
parameterEstimates(fit_Sw_EXTL_B)[c(170:174),c(1:3,5,8)]

parameterEstimates(fit_Pro_MDD_B)[c(170:174),c(1:3,5,8)]
parameterEstimates(fit_Pro_INTL_B)[c(170:174),c(1:3,5,8)]
parameterEstimates(fit_Pro_EXTL_B)[c(170:174),c(1:3,5,8)]


lavTestLRT(fit_Peer_MDD_IS, fit_Peer_MDD_IR)
lavTestLRT(fit_Peer_MDD_T, fit_Peer_MDD_IR)
lavTestLRT(fit_Peer_MDD, fit_Peer_MDD_IR)

lavTestLRT(fit_Peer_MDD_IS, fit_Peer_MDD_T)
lavTestLRT(fit_Peer_MDD_IR, fit_Peer_MDD_T)
lavTestLRT(fit_Peer_MDD, fit_Peer_MDD_T)

lavTestLRT(fit_Agg_EXTL_IS, fit_Agg_EXTL)
lavTestLRT(fit_Agg_EXTL_IR, fit_Agg_EXTL)
lavTestLRT(fit_Agg_EXTL_T, fit_Agg_EXTL)

lavTestLRT(fit_Sw_INTL_IS, fit_Sw_INTL_IR)
lavTestLRT(fit_Sw_INTL_T, fit_Sw_INTL_IR)
lavTestLRT(fit_Sw_INTL, fit_Sw_INTL_IR)

lavTestLRT(fit_Pro_INTL_IS, fit_Pro_INTL_IR)
lavTestLRT(fit_Pro_INTL_T, fit_Pro_INTL_IR)
lavTestLRT(fit_Pro_INTL, fit_Pro_INTL_IR)

lavTestLRT(fit_Pro_EXTL_IR, fit_Pro_EXTL_IS)
lavTestLRT(fit_Pro_EXTL_T, fit_Pro_EXTL_IS)
lavTestLRT(fit_Pro_EXTL, fit_Pro_EXTL_IS)

lavTestLRT(fit_Pro_EXTL_IS, fit_Pro_EXTL)
lavTestLRT(fit_Pro_EXTL_IR, fit_Pro_EXTL)
lavTestLRT(fit_Pro_EXTL_T, fit_Pro_EXTL)
```


## Latent growth curves
```{r latent growth curves}
#Peer victimization/rejection
Peer_MDD_growth <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeer residual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


iPeer=~1*Peer1+ 1*Peer2+ 1*Peer3+ 1*Peer4+ 1*Peer5+ 1*Peer6     # This defines the Peer intercept measurement model
sPeer=~0*Peer1+ 1*Peer2+ 2*Peer3+ 3*Peer4+ 4*Peer5+ 5*Peer6 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iMDD=~1*MDD1+ 1*MDD2+ 1*MDD3+ 1*MDD4+ 1*MDD5+ 1*MDD6  # This defines the MDD intercept measurement model
sMDD=~0*MDD1+ 1*MDD2+ 2*MDD3+ 3*MDD4+ 4*MDD5+ 5*MDD6 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPeer                      # This estimates the iMDD sPeer covariance
iMDD~~iPeer                      # This estimates the iMDD iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sMDD                      # This estimates the iPeer sMDD covariance
sPeer~~sMDD                      # This estimates the sPeer sMDD covariance


#Covariates
iPeer ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sPeer ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iMDD ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sMDD ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Peer_MDD_growth <- lavaan(Peer_MDD_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Peer_MDD_growth, fit.measures=T, standardized=T)


Peer_INTL_growth <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeer residual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


iPeer=~1*Peer1+ 1*Peer2+ 1*Peer3+ 1*Peer4+ 1*Peer5+ 1*Peer6     # This defines the Peer intercept measurement model
sPeer=~0*Peer1+ 1*Peer2+ 2*Peer3+ 3*Peer4+ 4*Peer5+ 5*Peer6 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iINTL=~1*INTL1+ 1*INTL2+ 1*INTL3+ 1*INTL4+ 1*INTL5+ 1*INTL6  # This defines the INTL intercept measurement model
sINTL=~0*INTL1+ 1*INTL2+ 2*INTL3+ 3*INTL4+ 4*INTL5+ 5*INTL6 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPeer                      # This estimates the iINTL sPeer covariance
iINTL~~iPeer                      # This estimates the iINTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sINTL                      # This estimates the iPeer sINTL covariance
sPeer~~sINTL                      # This estimates the sPeer sINTL covariance


#Covariates
iPeer ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sPeer ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iINTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sINTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Peer_INTL_growth <- lavaan(Peer_INTL_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Peer_INTL_growth, fit.measures=T, standardized=T)


Peer_EXTL_growth <- '
#Defining the latent variables
Peer1=~1*PPeer_1+1*TPeer_1
Peer2=~1*PPeer_3+1*TPeer_3
Peer3=~1*PPeer_5+1*TPeer_5
Peer4=~1*PPeer_10+1*TPeer_10
Peer5=~1*PPeer_12+1*TPeer_12
Peer6=~1*PPeer_14+1*TPeer_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Estimate residual variances
PPeer_1~~PPeer_1          # This estimates the PPeer residual variances
PPeer_3~~PPeer_3
PPeer_5~~PPeer_5
PPeer_10~~PPeer_10
PPeer_12~~PPeer_12
PPeer_14~~PPeer_14

TPeer_1~~TPeer_1          # This estimates the TPeerresidual variances
TPeer_3~~TPeer_3
TPeer_5~~TPeer_5
TPeer_10~~TPeer_10
TPeer_12~~TPeer_12
TPeer_14~~TPeer_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


iPeer=~1*Peer1+ 1*Peer2+ 1*Peer3+ 1*Peer4+ 1*Peer5+ 1*Peer6     # This defines the Peer intercept measurement model
sPeer=~0*Peer1+ 1*Peer2+ 2*Peer3+ 3*Peer4+ 4*Peer5+ 5*Peer6 # This defines the Peer slope measurement model
iPeer~1                             # This estimates the Peer intercept intercept (mean)
iPeer~~iPeer                         # This estimates the Peer intercept variance
sPeer~1                             # This estimates the Peer slope intercept
sPeer~~sPeer                         # This estimates the Peer slope variance

iEXTL=~1*EXTL1+ 1*EXTL2+ 1*EXTL3+ 1*EXTL4+ 1*EXTL5+ 1*EXTL6  # This defines the EXTL intercept measurement model
sEXTL=~0*EXTL1+ 1*EXTL2+ 2*EXTL3+ 3*EXTL4+ 4*EXTL5+ 5*EXTL6 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPeer                      # This estimates the iEXTL sPeer covariance
iEXTL~~iPeer                      # This estimates the iEXTL iPeer covariance
iPeer~~sPeer                      # This estimates the iPeer sPeer covariance
iPeer~~sEXTL                      # This estimates the iPeer sEXTL covariance
sPeer~~sEXTL                      # This estimates the sPeer sEXTL covariance


#Covariates
iPeer ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sPeer ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iEXTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sEXTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Peer_EXTL_growth <- lavaan(Peer_EXTL_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Peer_EXTL_growth, fit.measures=T, standardized=T)


#Aggression
Agg_MDD_growth <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAgg residual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


iAgg=~1*Agg1+ 1*Agg2+ 1*Agg3+ 1*Agg4+ 1*Agg5+ 1*Agg6     # This defines the Agg intercept measurement model
sAgg=~0*Agg1+ 1*Agg2+ 2*Agg3+ 3*Agg4+ 4*Agg5+ 5*Agg6 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iMDD=~1*MDD1+ 1*MDD2+ 1*MDD3+ 1*MDD4+ 1*MDD5+ 1*MDD6  # This defines the MDD intercept measurement model
sMDD=~0*MDD1+ 1*MDD2+ 2*MDD3+ 3*MDD4+ 4*MDD5+ 5*MDD6 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sAgg                      # This estimates the iMDD sAgg covariance
iMDD~~iAgg                      # This estimates the iMDD iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sMDD                      # This estimates the iAgg sMDD covariance
sAgg~~sMDD                      # This estimates the sAgg sMDD covariance


#Covariates
iAgg ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sAgg ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iMDD ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sMDD ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Agg_MDD_growth <- lavaan(Agg_MDD_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Agg_MDD_growth, fit.measures=T, standardized=T)


Agg_INTL_growth <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAgg residual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


iAgg=~1*Agg1+ 1*Agg2+ 1*Agg3+ 1*Agg4+ 1*Agg5+ 1*Agg6     # This defines the Agg intercept measurement model
sAgg=~0*Agg1+ 1*Agg2+ 2*Agg3+ 3*Agg4+ 4*Agg5+ 5*Agg6 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iINTL=~1*INTL1+ 1*INTL2+ 1*INTL3+ 1*INTL4+ 1*INTL5+ 1*INTL6  # This defines the INTL intercept measurement model
sINTL=~0*INTL1+ 1*INTL2+ 2*INTL3+ 3*INTL4+ 4*INTL5+ 5*INTL6 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sAgg                      # This estimates the iINTL sAgg covariance
iINTL~~iAgg                      # This estimates the iINTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sINTL                      # This estimates the iAgg sINTL covariance
sAgg~~sINTL                      # This estimates the sAgg sINTL covariance


#Covariates
iAgg ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sAgg ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iINTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sINTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Agg_INTL_growth <- lavaan(Agg_INTL_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Agg_INTL_growth, fit.measures=T, standardized=T)


Agg_EXTL_growth <- '
#Defining the latent variables
Agg1=~1*PAgg_1+1*TAgg_1
Agg2=~1*PAgg_3+1*TAgg_3
Agg3=~1*PAgg_5+1*TAgg_5
Agg4=~1*PAgg_10+1*TAgg_10
Agg5=~1*PAgg_12+1*TAgg_12
Agg6=~1*PAgg_14+1*TAgg_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Estimate residual variances
PAgg_1~~PAgg_1          # This estimates the PAgg residual variances
PAgg_3~~PAgg_3
PAgg_5~~PAgg_5
PAgg_10~~PAgg_10
PAgg_12~~PAgg_12
PAgg_14~~PAgg_14

TAgg_1~~TAgg_1          # This estimates the TAggresidual variances
TAgg_3~~TAgg_3
TAgg_5~~TAgg_5
TAgg_10~~TAgg_10
TAgg_12~~TAgg_12
TAgg_14~~TAgg_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


iAgg=~1*Agg1+ 1*Agg2+ 1*Agg3+ 1*Agg4+ 1*Agg5+ 1*Agg6     # This defines the Agg intercept measurement model
sAgg=~0*Agg1+ 1*Agg2+ 2*Agg3+ 3*Agg4+ 4*Agg5+ 5*Agg6 # This defines the Agg slope measurement model
iAgg~1                             # This estimates the Agg intercept intercept (mean)
iAgg~~iAgg                         # This estimates the Agg intercept variance
sAgg~1                             # This estimates the Agg slope intercept
sAgg~~sAgg                         # This estimates the Agg slope variance

iEXTL=~1*EXTL1+ 1*EXTL2+ 1*EXTL3+ 1*EXTL4+ 1*EXTL5+ 1*EXTL6  # This defines the EXTL intercept measurement model
sEXTL=~0*EXTL1+ 1*EXTL2+ 2*EXTL3+ 3*EXTL4+ 4*EXTL5+ 5*EXTL6 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sAgg                      # This estimates the iEXTL sAgg covariance
iEXTL~~iAgg                      # This estimates the iEXTL iAgg covariance
iAgg~~sAgg                      # This estimates the iAgg sAgg covariance
iAgg~~sEXTL                      # This estimates the iAgg sEXTL covariance
sAgg~~sEXTL                      # This estimates the sAgg sEXTL covariance


#Covariates
iAgg ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sAgg ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iEXTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sEXTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Agg_EXTL_growth <- lavaan(Agg_EXTL_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Agg_EXTL_growth, fit.measures=T, standardized=T)


##Social Withdrawal
Sw_MDD_growth <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSw residual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


iSw=~1*Sw1+ 1*Sw2+ 1*Sw3+ 1*Sw4+ 1*Sw5+ 1*Sw6     # This defines the Sw intercept measurement model
sSw=~0*Sw1+ 1*Sw2+ 2*Sw3+ 3*Sw4+ 4*Sw5+ 5*Sw6 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iMDD=~1*MDD1+ 1*MDD2+ 1*MDD3+ 1*MDD4+ 1*MDD5+ 1*MDD6  # This defines the MDD intercept measurement model
sMDD=~0*MDD1+ 1*MDD2+ 2*MDD3+ 3*MDD4+ 4*MDD5+ 5*MDD6 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sSw                      # This estimates the iMDD sSw covariance
iMDD~~iSw                      # This estimates the iMDD iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sMDD                      # This estimates the iSw sMDD covariance
sSw~~sMDD                      # This estimates the sSw sMDD covariance


#Covariates
iSw ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sSw ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iMDD ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sMDD ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Sw_MDD_growth <- lavaan(Sw_MDD_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Sw_MDD_growth, fit.measures=T, standardized=T)


Sw_INTL_growth <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSw residual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


iSw=~1*Sw1+ 1*Sw2+ 1*Sw3+ 1*Sw4+ 1*Sw5+ 1*Sw6     # This defines the Sw intercept measurement model
sSw=~0*Sw1+ 1*Sw2+ 2*Sw3+ 3*Sw4+ 4*Sw5+ 5*Sw6 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iINTL=~1*INTL1+ 1*INTL2+ 1*INTL3+ 1*INTL4+ 1*INTL5+ 1*INTL6  # This defines the INTL intercept measurement model
sINTL=~0*INTL1+ 1*INTL2+ 2*INTL3+ 3*INTL4+ 4*INTL5+ 5*INTL6 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sSw                      # This estimates the iINTL sSw covariance
iINTL~~iSw                      # This estimates the iINTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sINTL                      # This estimates the iSw sINTL covariance
sSw~~sINTL                      # This estimates the sSw sINTL covariance


#Covariates
iSw ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sSw ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iINTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sINTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Sw_INTL_growth <- lavaan(Sw_INTL_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Sw_INTL_growth, fit.measures=T, standardized=T)


Sw_EXTL_growth <- '
#Defining the latent variables
Sw1=~1*PSw_1+1*TSw_1
Sw2=~1*PSw_3+1*TSw_3
Sw3=~1*PSw_5+1*TSw_5
Sw4=~1*PSw_10+1*TSw_10
Sw5=~1*PSw_12+1*TSw_12
Sw6=~1*PSw_14+1*TSw_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Estimate residual variances
PSw_1~~PSw_1          # This estimates the PSw residual variances
PSw_3~~PSw_3
PSw_5~~PSw_5
PSw_10~~PSw_10
PSw_12~~PSw_12
PSw_14~~PSw_14

TSw_1~~TSw_1          # This estimates the TSwresidual variances
TSw_3~~TSw_3
TSw_5~~TSw_5
TSw_10~~TSw_10
TSw_12~~TSw_12
TSw_14~~TSw_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


iSw=~1*Sw1+ 1*Sw2+ 1*Sw3+ 1*Sw4+ 1*Sw5+ 1*Sw6     # This defines the Sw intercept measurement model
sSw=~0*Sw1+ 1*Sw2+ 2*Sw3+ 3*Sw4+ 4*Sw5+ 5*Sw6 # This defines the Sw slope measurement model
iSw~1                             # This estimates the Sw intercept intercept (mean)
iSw~~iSw                         # This estimates the Sw intercept variance
sSw~1                             # This estimates the Sw slope intercept
sSw~~sSw                         # This estimates the Sw slope variance

iEXTL=~1*EXTL1+ 1*EXTL2+ 1*EXTL3+ 1*EXTL4+ 1*EXTL5+ 1*EXTL6  # This defines the EXTL intercept measurement model
sEXTL=~0*EXTL1+ 1*EXTL2+ 2*EXTL3+ 3*EXTL4+ 4*EXTL5+ 5*EXTL6 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sSw                      # This estimates the iEXTL sSw covariance
iEXTL~~iSw                      # This estimates the iEXTL iSw covariance
iSw~~sSw                      # This estimates the iSw sSw covariance
iSw~~sEXTL                      # This estimates the iSw sEXTL covariance
sSw~~sEXTL                      # This estimates the sSw sEXTL covariance


#Covariates
iSw ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sSw ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iEXTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sEXTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Sw_EXTL_growth <- lavaan(Sw_EXTL_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Sw_EXTL_growth, fit.measures=T, standardized=T)


##Prosocial
Pro_MDD_growth <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

MDD1=~1*MDDPRP100_1
MDD2=~1*MDDPRP100_3
MDD3=~1*MDDPRP100_5
MDD4=~1*MDDPRP100_10
MDD5=~1*MDDPRP100_12
MDD6=~1*MDDPRP100_14

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PPro residual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

MDDPRP100_1~~MDDPRP100_1          # This estimates the MDD residual variances
MDDPRP100_3~~MDDPRP100_3
MDDPRP100_5~~MDDPRP100_5
MDDPRP100_10~~MDDPRP100_10
MDDPRP100_12~~MDDPRP100_12
MDDPRP100_14~~MDDPRP100_14


iPro=~1*Pro1+ 1*Pro2+ 1*Pro3+ 1*Pro4+ 1*Pro5+ 1*Pro6     # This defines the Pro intercept measurement model
sPro=~0*Pro1+ 1*Pro2+ 2*Pro3+ 3*Pro4+ 4*Pro5+ 5*Pro6 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iMDD=~1*MDD1+ 1*MDD2+ 1*MDD3+ 1*MDD4+ 1*MDD5+ 1*MDD6  # This defines the MDD intercept measurement model
sMDD=~0*MDD1+ 1*MDD2+ 2*MDD3+ 3*MDD4+ 4*MDD5+ 5*MDD6 # This defines the MDD slope measurement model
iMDD~1                             # This estimates the MDD intercept intercept (mean)
iMDD~~iMDD                         # This estimates the MDD intercept variance
sMDD~1                             # This estimates the MDD slope intercept
sMDD~~sMDD                         # This estimates the MDD slope variance

iMDD~~sMDD                      # This estimates the iMDD sMDD covariance
iMDD~~sPro                      # This estimates the iMDD sPro covariance
iMDD~~iPro                      # This estimates the iMDD iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sMDD                      # This estimates the iPro sMDD covariance
sPro~~sMDD                      # This estimates the sPro sMDD covariance


#Covariates
iPro ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sPro ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iMDD ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sMDD ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Pro_MDD_growth <- lavaan(Pro_MDD_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Pro_MDD_growth, fit.measures=T, standardized=T)


Pro_INTL_growth <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

INTL1=~1*INTL_1
INTL2=~1*INTL_3
INTL3=~1*INTL_5
INTL4=~1*INTL_10
INTL5=~1*INTL_12
INTL6=~1*INTL_14

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PPro residual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

INTL_1~~INTL_1          # This estimates the INTL residual variances
INTL_3~~INTL_3
INTL_5~~INTL_5
INTL_10~~INTL_10
INTL_12~~INTL_12
INTL_14~~INTL_14


iPro=~1*Pro1+ 1*Pro2+ 1*Pro3+ 1*Pro4+ 1*Pro5+ 1*Pro6     # This defines the Pro intercept measurement model
sPro=~0*Pro1+ 1*Pro2+ 2*Pro3+ 3*Pro4+ 4*Pro5+ 5*Pro6 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iINTL=~1*INTL1+ 1*INTL2+ 1*INTL3+ 1*INTL4+ 1*INTL5+ 1*INTL6  # This defines the INTL intercept measurement model
sINTL=~0*INTL1+ 1*INTL2+ 2*INTL3+ 3*INTL4+ 4*INTL5+ 5*INTL6 # This defines the INTL slope measurement model
iINTL~1                             # This estimates the INTL intercept intercept (mean)
iINTL~~iINTL                         # This estimates the INTL intercept variance
sINTL~1                             # This estimates the INTL slope intercept
sINTL~~sINTL                         # This estimates the INTL slope variance

iINTL~~sINTL                      # This estimates the iINTL sINTL covariance
iINTL~~sPro                      # This estimates the iINTL sPro covariance
iINTL~~iPro                      # This estimates the iINTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sINTL                      # This estimates the iPro sINTL covariance
sPro~~sINTL                      # This estimates the sPro sINTL covariance


#Covariates
iPro ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sPro ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iINTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sINTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Pro_INTL_growth <- lavaan(Pro_INTL_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Pro_INTL_growth, fit.measures=T, standardized=T)


Pro_EXTL_growth <- '
#Defining the latent variables
Pro1=~1*PPro_1+1*TPro_1
Pro2=~1*PPro_3+1*TPro_3
Pro3=~1*PPro_5+1*TPro_5
Pro4=~1*PPro_10+1*TPro_10
Pro5=~1*PPro_12+1*TPro_12
Pro6=~1*PPro_14+1*TPro_14

EXTL1=~1*EXTL_1
EXTL2=~1*EXTL_3
EXTL3=~1*EXTL_5
EXTL4=~1*EXTL_10
EXTL5=~1*EXTL_12
EXTL6=~1*EXTL_14

#Estimate residual variances
PPro_1~~PPro_1          # This estimates the PPro residual variances
PPro_3~~PPro_3
PPro_5~~PPro_5
PPro_10~~PPro_10
PPro_12~~PPro_12
PPro_14~~PPro_14

TPro_1~~TPro_1          # This estimates the TProresidual variances
TPro_3~~TPro_3
TPro_5~~TPro_5
TPro_10~~TPro_10
TPro_12~~TPro_12
TPro_14~~TPro_14

EXTL_1~~EXTL_1          # This estimates the EXTL residual variances
EXTL_3~~EXTL_3
EXTL_5~~EXTL_5
EXTL_10~~EXTL_10
EXTL_12~~EXTL_12
EXTL_14~~EXTL_14


iPro=~1*Pro1+ 1*Pro2+ 1*Pro3+ 1*Pro4+ 1*Pro5+ 1*Pro6     # This defines the Pro intercept measurement model
sPro=~0*Pro1+ 1*Pro2+ 2*Pro3+ 3*Pro4+ 4*Pro5+ 5*Pro6 # This defines the Pro slope measurement model
iPro~1                             # This estimates the Pro intercept intercept (mean)
iPro~~iPro                         # This estimates the Pro intercept variance
sPro~1                             # This estimates the Pro slope intercept
sPro~~sPro                         # This estimates the Pro slope variance

iEXTL=~1*EXTL1+ 1*EXTL2+ 1*EXTL3+ 1*EXTL4+ 1*EXTL5+ 1*EXTL6  # This defines the EXTL intercept measurement model
sEXTL=~0*EXTL1+ 1*EXTL2+ 2*EXTL3+ 3*EXTL4+ 4*EXTL5+ 5*EXTL6 # This defines the EXTL slope measurement model
iEXTL~1                             # This estimates the EXTL intercept intercept (mean)
iEXTL~~iEXTL                         # This estimates the EXTL intercept variance
sEXTL~1                             # This estimates the EXTL slope intercept
sEXTL~~sEXTL                         # This estimates the EXTL slope variance

iEXTL~~sEXTL                      # This estimates the iEXTL sEXTL covariance
iEXTL~~sPro                      # This estimates the iEXTL sPro covariance
iEXTL~~iPro                      # This estimates the iEXTL iPro covariance
iPro~~sPro                      # This estimates the iPro sPro covariance
iPro~~sEXTL                      # This estimates the iPro sEXTL covariance
sPro~~sEXTL                      # This estimates the sPro sEXTL covariance


#Covariates
iPro ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sPro ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
iEXTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
sEXTL ~ sex_01 + ethin + T1Income_to_Need + IQ + T1_ACES_sum + first_MDDBP
'

fit_Pro_EXTL_growth <- lavaan(Pro_EXTL_growth, data=data_wide, missing="FIML", estimator="MLR")
#summary(fit_Pro_EXTL_growth, fit.measures=T, standardized=T)
```

```{r Concatenating growth model results into a table}
Growth_results <- as.data.frame(matrix(nrow=16, ncol=12))
colnames(Growth_results) <- c("1","2","3","MDD_Estimate","MDD_ci.lower","MDD_ci.upper",
                                          "INTL_Estimate","INTL_ci.lower","INTL_ci.upper",
                                          "EXTL_Estimate","EXTL_ci.lower","EXTL_ci.upper")

#Peer growth model results
Growth_results[1:4,1:6] <- parameterEstimates(fit_Peer_MDD_growth)[c(73,70,71,74),c(1:3,4,8:9)]
Growth_results[1:4,7:9] <- parameterEstimates(fit_Peer_INTL_growth)[c(73,70,71,74),c(4,8:9)]
Growth_results[1:4,10:12] <- parameterEstimates(fit_Peer_EXTL_growth)[c(73,70,71,74),c(4,8:9)]

#Agg growth model results
Growth_results[5:8,1:6] <- parameterEstimates(fit_Agg_MDD_growth)[c(73,70,71,74),c(1:3,4,8:9)]
Growth_results[5:8,7:9] <- parameterEstimates(fit_Agg_INTL_growth)[c(73,70,71,74),c(4,8:9)]
Growth_results[5:8,10:12] <- parameterEstimates(fit_Agg_EXTL_growth)[c(73,70,71,74),c(4,8:9)]

#Sw growth model results
Growth_results[9:12,1:6] <- parameterEstimates(fit_Sw_MDD_growth)[c(73,70,71,74),c(1:3,4,8:9)]
Growth_results[9:12,7:9] <- parameterEstimates(fit_Sw_INTL_growth)[c(73,70,71,74),c(4,8:9)]
Growth_results[9:12,10:12] <- parameterEstimates(fit_Sw_EXTL_growth)[c(73,70,71,74),c(4,8:9)]

#Pro growth model results
Growth_results[13:16,1:6] <- parameterEstimates(fit_Pro_MDD_growth)[c(73,70,71,74),c(1:3,4,8:9)]
Growth_results[13:16,7:9] <- parameterEstimates(fit_Pro_INTL_growth)[c(73,70,71,74),c(4,8:9)]
Growth_results[13:16,10:12] <- parameterEstimates(fit_Pro_EXTL_growth)[c(73,70,71,74),c(4,8:9)]

Growth_results[,4:12] <- round(Growth_results[,4:12], 3)

kable(Growth_results, align=c('l',rep('c', 10)))
```
